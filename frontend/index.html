<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pyxolotl ‚Äì Indie Games Marketplace</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ============================================ */
    /* BARRA DE B√öSQUEDA ESTILO STEAM */
    /* ============================================ */
    .search-container {
      position: relative;
      max-width: 100%;
      margin-bottom: 30px;
    }
    .search-bar {
      display: flex;
      gap: 12px;
      background: rgba(0,0,0,0.4);
      padding: 16px 20px;
      border-radius: 12px;
      border: 1px solid rgba(123,97,255,0.2);
      flex-wrap: wrap;
    }
    .search-input-wrapper {
      flex: 1;
      min-width: 250px;
      position: relative;
    }
    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      color: #fff;
      font-size: 15px;
      transition: all 0.3s;
    }
    .search-input:focus {
      outline: none;
      border-color: var(--accent-1);
      background: rgba(255,255,255,0.08);
    }
    .search-input::placeholder { color: #666; }
    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
      font-size: 18px;
    }
    .filter-group {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .filter-select {
      padding: 10px 14px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      min-width: 140px;
    }
    .filter-select:focus { outline: none; border-color: var(--accent-1); }
    .filter-select option { background: #1a1f35; color: #fff; }
    
    /* Dropdown de resultados de b√∫squeda */
    .search-results-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, #1a2744 0%, #0f1829 100%);
      border: 1px solid rgba(123,97,255,0.3);
      border-radius: 0 0 12px 12px;
      max-height: 500px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
      box-shadow: 0 12px 40px rgba(0,0,0,0.5);
    }
    .search-results-dropdown.active { display: block; }
    .search-result-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      gap: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
      transition: background 0.2s;
    }
    .search-result-item:hover { background: rgba(123,97,255,0.1); }
    .search-result-img {
      width: 120px;
      height: 45px;
      border-radius: 4px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #07102a;
      font-size: 14px;
      flex-shrink: 0;
    }
    .search-result-img img { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; }
    .search-result-info { flex: 1; min-width: 0; }
    .search-result-title { font-weight: 600; color: #fff; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .search-result-meta { font-size: 12px; color: #888; }
    .search-result-tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .search-result-tag { background: rgba(123,97,255,0.15); color: var(--accent-1); padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .search-result-price { text-align: right; min-width: 100px; }
    .search-result-price-value { font-weight: 700; color: #fff; font-size: 15px; }
    .search-result-price-discount { display: flex; align-items: center; gap: 8px; justify-content: flex-end; }
    .discount-badge { background: #4c6b22; color: #a4d007; padding: 2px 6px; border-radius: 3px; font-size: 12px; font-weight: 600; }
    .price-original { color: #666; text-decoration: line-through; font-size: 12px; }
    .search-result-date { font-size: 11px; color: #666; margin-top: 2px; }
    .search-no-results { padding: 30px; text-align: center; color: #666; }
    
    /* ============================================ */
    /* SECCI√ìN DESTACADO */
    /* ============================================ */
    .featured-container {
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      padding: 20px;
      border-radius: 16px;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .featured-container:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(123,97,255,0.4);
    }
    .featured-label { color: #07102a; font-weight: 700; margin-bottom: 12px; font-size: 14px; }
    .featured-content {
      height: 220px;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(7,16,42,0.3), rgba(7,16,42,0.5));
      display: flex;
      overflow: hidden;
    }
    .featured-image {
      width: 55%;
      height: 100%;
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: bold;
      color: rgba(255,255,255,0.3);
    }
    .featured-info {
      width: 45%;
      padding: 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .featured-title { font-size: 18px; font-weight: 700; color: #07102a; margin-bottom: 8px; }
    .featured-desc { font-size: 13px; color: rgba(7,16,42,0.8); line-height: 1.4; flex: 1; overflow: hidden; }
    .featured-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
    .featured-rating { background: rgba(7,16,42,0.2); padding: 4px 10px; border-radius: 6px; font-size: 13px; color: #07102a; font-weight: 600; }
    .featured-price { font-size: 18px; font-weight: 700; color: #07102a; }
    
    /* ============================================ */
    /* SCROLL HORIZONTAL POR CATEGOR√çA */
    /* ============================================ */
    .category-section {
      margin-bottom: 40px;
    }
    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .category-title {
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .category-title span { color: var(--accent-1); }
    .category-count {
      font-size: 13px;
      color: var(--muted);
      background: rgba(255,255,255,0.05);
      padding: 4px 12px;
      border-radius: 20px;
    }
    .category-scroll-wrapper {
      position: relative;
    }
    .category-scroll {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 10px 0;
      scrollbar-width: thin;
      scrollbar-color: var(--accent-1) rgba(255,255,255,0.1);
    }
    .category-scroll::-webkit-scrollbar { height: 6px; }
    .category-scroll::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 3px; }
    .category-scroll::-webkit-scrollbar-thumb { background: var(--accent-1); border-radius: 3px; }
    .scroll-card {
      flex: 0 0 200px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
    }
    .scroll-card:hover {
      transform: translateY(-4px);
      border-color: var(--accent-1);
      box-shadow: 0 8px 24px rgba(123,97,255,0.2);
    }
    .scroll-card-img {
      height: 95px;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #07102a;
      font-size: 24px;
      overflow: hidden;
    }
    .scroll-card-img img { width: 100%; height: 100%; object-fit: cover; }
    .scroll-card-info { padding: 12px; }
    .scroll-card-title { font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .scroll-card-price { font-size: 14px; font-weight: 700; color: var(--accent-1); }
    .scroll-card-price.free { color: #4CAF50; }
    .scroll-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      cursor: pointer;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    .scroll-btn:hover { background: var(--accent-1); color: #07102a; }
    .scroll-btn-left { left: -18px; }
    .scroll-btn-right { right: -18px; }
    
    /* ============================================ */
    /* LISTA DE JUEGOS ESTILO STEAM */
    /* ============================================ */
    .games-list-section {
      margin-top: 50px;
      padding-top: 30px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .games-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }
    .games-list-title {
      font-size: 22px;
      font-weight: 700;
      color: #fff;
    }
    .games-list {
      display: flex;
      flex-direction: column;
      gap: 2px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      overflow: hidden;
    }
    .game-list-item {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      gap: 16px;
      background: linear-gradient(90deg, rgba(32,47,75,0.5), rgba(26,39,60,0.5));
      cursor: pointer;
      transition: background 0.2s;
    }
    .game-list-item:hover { background: linear-gradient(90deg, rgba(42,62,100,0.6), rgba(36,54,85,0.6)); }
    .game-list-img {
      width: 120px;
      height: 45px;
      border-radius: 4px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #07102a;
      font-size: 14px;
      flex-shrink: 0;
      overflow: hidden;
    }
    .game-list-img img { width: 100%; height: 100%; object-fit: cover; }
    .game-list-info { flex: 1; min-width: 0; }
    .game-list-title-text { font-weight: 600; color: #fff; margin-bottom: 4px; }
    .game-list-tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .game-list-tag { background: rgba(123,97,255,0.15); color: #8b7dcd; padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .game-list-rating { min-width: 80px; text-align: center; }
    .game-list-stars { color: #fbbf24; font-size: 13px; }
    .game-list-reviews { font-size: 11px; color: #666; margin-top: 2px; }
    .game-list-price { text-align: right; min-width: 100px; }
    .game-list-price-value { font-weight: 700; color: #fff; font-size: 15px; }
    .game-list-price-free { color: #4CAF50; font-weight: 600; font-size: 14px; }
    .game-list-date { font-size: 11px; color: #666; min-width: 90px; text-align: right; }
    .load-more-btn {
      display: block;
      width: 100%;
      padding: 16px;
      margin-top: 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--accent-1);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .load-more-btn:hover { background: rgba(123,97,255,0.1); border-color: var(--accent-1); }
    
    @media (max-width: 768px) {
      .search-bar { flex-direction: column; }
      .search-result-item { flex-wrap: wrap; }
      .search-result-img { width: 80px; height: 30px; }
      .search-result-price { width: 100%; text-align: left; margin-top: 8px; }
      .featured-content { flex-direction: column; height: auto; }
      .featured-image { width: 100%; height: 150px; }
      .featured-info { width: 100%; }
      .game-list-item { flex-wrap: wrap; }
      .game-list-img { width: 100%; height: 60px; }
      .game-list-rating, .game-list-date { display: none; }
    }
    
    /* Estilos para el perfil de usuario */
    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .user-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .user-avatar span {
      color: #07102a;
      font-weight: bold;
      font-size: 16px;
    }
    
    #userName {
      color: var(--accent-1);
      font-weight: 600;
      cursor: pointer;
    }
    
    #userName:hover {
      text-decoration: underline;
    }
    
    /* Modal de perfil */
    .profile-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .profile-modal.active {
      display: flex;
    }
    
    .profile-modal-content {
      background: var(--card);
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      animation: slideUp 0.4s ease;
    }
    
    .profile-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .profile-avatar-large {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      overflow: hidden;
      cursor: pointer;
      position: relative;
    }
    
    .profile-avatar-large:hover .avatar-overlay {
      opacity: 1;
    }
    
    .avatar-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .avatar-overlay span {
      color: white;
      font-size: 14px;
    }
    
    .profile-avatar-large img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-avatar-large span {
      color: #07102a;
      font-weight: bold;
      font-size: 48px;
    }
    
    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .profile-form label {
      display: flex;
      flex-direction: column;
      gap: 5px;
      color: var(--muted);
      font-size: 14px;
    }
    
    .profile-form input[type="text"],
    .profile-form textarea {
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: var(--glass);
      color: #fff;
      font-family: inherit;
    }
    
    .profile-form textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .profile-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .profile-actions button {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-save {
      background: linear-gradient(90deg, var(--accent-2), var(--accent-1));
      color: #07102a;
    }
    
    .btn-cancel {
      background: var(--glass);
      color: #fff;
    }
    
    .btn-save:hover,
    .btn-cancel:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    #avatarInput {
      display: none;
    }
    
    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* ========== SCREENSHOTS GALLERY ========== */
    .game-detail-screenshots {
      margin: 24px 0;
    }
    
    .game-detail-screenshots h3 {
      font-size: 18px;
      margin-bottom: 16px;
      color: #fff;
    }
    
    .screenshots-gallery {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    
    .screenshot-item {
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      aspect-ratio: 16/9;
      background: rgba(123, 97, 255, 0.1);
    }
    
    .screenshot-item:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 24px rgba(123, 97, 255, 0.3);
    }
    
    .screenshot-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Modal de imagen grande */
    .screenshot-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 20000;
      background: rgba(0, 0, 0, 0.95);
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .screenshot-modal.active {
      display: flex;
    }
    
    .screenshot-modal img {
      max-width: 90vw;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 8px;
    }
    
    .screenshot-modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 32px;
      color: #fff;
      background: none;
      border: none;
      cursor: pointer;
    }
    
    @media (max-width: 768px) {
      .screenshots-gallery {
        grid-template-columns: 1fr;
      }
    }
    
    /* ========== BIBLIOTECA MODAL ========== */
    .biblioteca-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 9000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .biblioteca-modal.active {
      display: flex;
    }
    
    .biblioteca-modal-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
    }
    
    .biblioteca-modal-content {
      position: relative;
      background: linear-gradient(180deg, #0d1526 0%, #07102a 100%);
      border: 1px solid rgba(123, 97, 255, 0.3);
      border-radius: 20px;
      max-width: 900px;
      width: 100%;
      max-height: 85vh;
      overflow: hidden;
      animation: slideUp 0.3s ease;
    }
    
    .biblioteca-modal-header {
      padding: 24px 30px;
      border-bottom: 1px solid rgba(123, 97, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .biblioteca-modal-header h2 {
      font-size: 24px;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
    }
    
    .biblioteca-modal-close {
      background: none;
      border: none;
      font-size: 28px;
      color: #888;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .biblioteca-modal-close:hover {
      color: #fff;
    }
    
    .biblioteca-modal-body {
      padding: 24px 30px;
      max-height: calc(85vh - 100px);
      overflow-y: auto;
    }
    
    .biblioteca-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .biblioteca-item {
      background: rgba(123, 97, 255, 0.08);
      border: 1px solid rgba(123, 97, 255, 0.2);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .biblioteca-item:hover {
      transform: translateY(-4px);
      border-color: var(--accent-1);
      box-shadow: 0 8px 24px rgba(123, 97, 255, 0.2);
    }
    
    .biblioteca-item-thumb {
      height: 120px;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      color: #07102a;
      overflow: hidden;
    }
    
    .biblioteca-item-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .biblioteca-item-info {
      padding: 12px;
    }
    
    .biblioteca-item-title {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .biblioteca-item-meta {
      font-size: 12px;
      color: var(--muted);
    }
    
    .biblioteca-empty {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    
    .biblioteca-empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    @media (max-width: 768px) {
      .biblioteca-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    /* ========== MEN√ö M√ìVIL ========== */
    @media (max-width: 900px) {
      .nav {
        position: fixed;
        top: 0;
        right: -100%;
        width: 280px;
        height: 100vh;
        background: linear-gradient(180deg, #0d1526 0%, #07102a 100%);
        flex-direction: column;
        padding: 80px 24px 24px;
        gap: 12px;
        z-index: 999;
        transition: right 0.3s ease;
        box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
        border-left: 1px solid rgba(123, 97, 255, 0.2);
        overflow-y: auto;
      }
      
      .nav.open {
        right: 0;
      }
      
      .nav a {
        padding: 12px 16px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.03);
        transition: all 0.2s ease;
        width: 100%;
        text-align: left;
      }
      
      .nav a:hover {
        background: rgba(123, 97, 255, 0.15);
      }
      
      .nav .user-profile {
        flex-direction: column;
        gap: 12px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(123, 97, 255, 0.2);
      }
      
      #menuBtn {
        display: block !important;
        position: relative;
        z-index: 1001;
        font-size: 24px;
      }
      
      /* Overlay cuando el men√∫ est√° abierto */
      .menu-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 998;
      }
      
      .menu-overlay.show {
        display: block;
      }
    }
    
    @media (min-width: 901px) {
      #menuBtn {
        display: none !important;
      }
      .menu-overlay {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <header class="container header">
    <div class="brand" onclick="window.location.href='index.html'" style="cursor:pointer">
      <img id="brandImg" src="PIXOLOTEL.png" alt="Logo Pyxolotl" class="brand-logo" data-initials="PX" onerror="this.style.display='none'">
      <span id="brandFallback" class="logo" aria-hidden="true" style="display:none">PX</span>

      <div>
        <div class="site-title">Pyxolotl</div>
        <div style="font-size:12px;color:var(--muted)">Marketplace de juegos indie mexicanos</div>
      </div>
    </div>

    <nav class="nav">
      <a href="#gallery">Juegos</a>
      <a href="#about">Acerca</a>
      <a href="biblioteca.html" id="bibliotecaLink">üìö Biblioteca</a>
      <a class="cta" href="#" onclick="validarPublicarJuego(event)" id="publicarBtn">Presentar juego</a>
      <a class="btn btn-ghost" href="inicio.html" id="loginBtn">Iniciar sesi√≥n</a>
      <a class="btn" href="inicio.html#registro" id="registerBtn" style="background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a">Registrarse</a>
      
      <!-- Perfil del usuario (oculto por defecto) -->
      <div id="userProfile" class="user-profile" style="display:none">
        <!-- Avatar circular con foto o iniciales -->
        <div id="userAvatar" class="user-avatar" onclick="openProfileModal()">
          <span id="userInitials">U</span>
        </div>
        <span id="userName" style="cursor:pointer" onclick="openProfileModal()">Usuario</span>
        <button id="logoutBtn" class="btn btn-ghost">Cerrar sesi√≥n</button>
      </div>
      
      <button id="cartBtn" class="btn btn-ghost" style="position:relative">
        üõí <span id="cartCount" class="cart-badge">0</span>
      </button>
    </nav>

    <button id="menuBtn" class="btn btn-ghost" aria-label="menu">‚ò∞</button>
  </header>
  
  <!-- Overlay para men√∫ m√≥vil -->
  <div id="menuOverlay" class="menu-overlay"></div>

  <!-- Modal de Biblioteca -->
  <div id="bibliotecaModal" class="biblioteca-modal">
    <div class="biblioteca-modal-overlay" onclick="closeBibliotecaModal()"></div>
    <div class="biblioteca-modal-content">
      <div class="biblioteca-modal-header">
        <h2>üìö Mi Biblioteca</h2>
        <button class="biblioteca-modal-close" onclick="closeBibliotecaModal()">&times;</button>
      </div>
      <div class="biblioteca-modal-body">
        <div id="bibliotecaLoading" style="text-align:center;padding:40px;">
          <div style="font-size:48px;animation:pulse 1s infinite">üìö</div>
          <p style="color:var(--muted);margin-top:12px">Cargando tu biblioteca...</p>
        </div>
        <div id="bibliotecaEmpty" class="biblioteca-empty" style="display:none;">
          <div class="biblioteca-empty-icon">üì≠</div>
          <h3>Tu biblioteca est√° vac√≠a</h3>
          <p>A√∫n no tienes juegos. ¬°Explora el cat√°logo y encuentra algo que te guste!</p>
          <button class="btn" onclick="closeBibliotecaModal()" style="margin-top:20px;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a">
            üéÆ Explorar juegos
          </button>
        </div>
        <div id="bibliotecaGrid" class="biblioteca-grid" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Modal de Screenshot grande -->
  <div id="screenshotModal" class="screenshot-modal" onclick="closeScreenshotModal()">
    <button class="screenshot-modal-close">&times;</button>
    <img id="screenshotModalImg" src="" alt="Screenshot">
  </div>

  <!-- Modal de Perfil de Usuario -->
  <div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
      <div class="profile-header">
        <h2>Mi Perfil</h2>
        <div class="profile-avatar-large" onclick="document.getElementById('avatarInput').click()">
          <img id="profileAvatarImg" src="" alt="" style="display:none">
          <span id="profileInitials">U</span>
          <div class="avatar-overlay">
            <span>Cambiar foto</span>
          </div>
        </div>
        <input type="file" id="avatarInput" accept="image/*" onchange="handleAvatarChange(event)">
        <h3 id="profileName">Usuario</h3>
        <p style="color:var(--muted);font-size:14px" id="profileEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0e6b636f67624e6b646b637e6261206d6163">[email&#160;protected]</a></p>
      </div>
      
      <form class="profile-form" id="profileForm">
        <label>
          Sobrenombre (m√°ximo 16 caracteres)
          <input type="text" id="nickname" maxlength="16" placeholder="Tu sobrenombre">
        </label>
        
        <label>
          Descripci√≥n personal
          <textarea id="description" placeholder="Cu√©ntanos algo sobre ti..."></textarea>
        </label>
        
        <div class="profile-actions">
          <button type="button" class="btn-cancel" onclick="closeProfileModal()">Cancelar</button>
          <button type="submit" class="btn-save">Guardar cambios</button>
        </div>
      </form>
    </div>
  </div>

  <main class="container">
    <section class="hero fade-in">
      <div class="hero-left">
        <span class="kicker">Beta ¬∑ Pyxolotl</span>
        <h1>M√°s visibilidad para desarrolladores indie mexicanos</h1>
        <p>Pyxolotl es una vitrina pensada para creadores de videojuegos independientes. Sub√≠ tu proyecto, consigue feedback y llega a jugadores.</p>

        <div class="hero-cta">
          <a class="btn" href="#gallery" style="background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a">Explorar juegos</a>
          <a class="btn btn-ghost" href="#" onclick="validarPublicarJuego(event)" id="publicarBtnHero">Presentar tu juego</a>
        </div>
      </div>

      <div style="flex:1">
        <div id="featuredGame" class="featured-container" onclick="openFeaturedGame()">
          <div class="featured-label">‚≠ê Destacado</div>
          <div class="featured-content">
            <div id="featuredImage" class="featured-image">üéÆ</div>
            <div class="featured-info">
              <div>
                <div id="featuredTitle" class="featured-title">Cargando...</div>
                <div id="featuredDesc" class="featured-desc">Descubre el juego mejor valorado de nuestra comunidad</div>
              </div>
              <div class="featured-meta">
                <span id="featuredRating" class="featured-rating">‚òÖ 0.0</span>
                <span id="featuredPrice" class="featured-price">--</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Mensaje promocional para no-desarrolladores -->
    <div id="developerPromo" class="developer-promo" style="display:none; background: linear-gradient(135deg, var(--accent-1), var(--accent-2)); padding: 30px; border-radius: 16px; margin: 40px 0; text-align: center;">
      <h3 style="color: #07102a; margin-bottom: 15px;">üéÆ ¬øTe interesa publicar un videojuego?</h3>
      <p style="color: #07102a; font-size: 18px; font-weight: 500; margin-bottom: 20px;">
        ¬°Reg√≠strate como Desarrollador y contribuye al crecimiento de esta comunidad!
      </p>
      <div style="background: rgba(7, 16, 42, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
        <p style="color: #07102a; font-weight: 600; margin: 0;">
          üìå Para registrarte como Desarrollador:
        </p>
        <ol style="color: #07102a; text-align: left; max-width: 500px; margin: 10px auto 0;">
          <li>Haz clic en el bot√≥n <strong>"Registrarse"</strong> a continuaci√≥n</li>
          <li>En el men√∫ desplegable de <strong>"Tipo de Cuenta"</strong></li>
          <li>Selecciona <strong>"Desarrollador"</strong></li>
          <li>Completa tu registro y empieza a publicar tus juegos</li>
        </ol>
      </div>
      <a href="inicio.html#registro" class="btn" style="background: #07102a; color: white; padding: 15px 30px; font-size: 18px; font-weight: 600; display: inline-block;">
        Registrarse
      </a>
    </div>



    <section id="gallery">
      <h2 style="margin-top:0">Cat√°logo de Juegos</h2>
      
      <!-- BARRA DE B√öSQUEDA -->
      <div class="search-container">
        <div class="search-bar">
          <div class="search-input-wrapper">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar por nombre o g√©nero..." autocomplete="off">
            <div id="searchDropdown" class="search-results-dropdown"></div>
          </div>
          <div class="filter-group">
            <select id="filterPrice" class="filter-select">
              <option value="">üí∞ Cualquier precio</option>
              <option value="free">Gratis</option>
              <option value="0-50">$0 - $50</option>
              <option value="50-100">$50 - $100</option>
              <option value="100-200">$100 - $200</option>
              <option value="200+">$200+</option>
            </select>
            <select id="filterRating" class="filter-select">
              <option value="">‚≠ê Cualquier valoraci√≥n</option>
              <option value="4">4+ estrellas</option>
              <option value="3">3+ estrellas</option>
              <option value="2">2+ estrellas</option>
              <option value="1">1+ estrellas</option>
            </select>
            <select id="filterGenre" class="filter-select">
              <option value="">üéÆ Todos los g√©neros</option>
            </select>
          </div>
        </div>
      </div>

      <!-- SECCIONES POR CATEGOR√çA (din√°mico) -->
      <div id="categorySections"></div>

      <!-- LISTA DE JUEGOS RECIENTES -->
      <div class="games-list-section">
        <div class="games-list-header">
          <h3 class="games-list-title">üïπÔ∏è Novedades - Todos los Juegos</h3>
          <span id="totalGamesCount" style="color:var(--muted);font-size:14px"></span>
        </div>
        <div id="gamesList" class="games-list"></div>
        <button id="loadMoreBtn" class="load-more-btn" style="display:none" onclick="loadMoreGames()">
          Ver m√°s juegos
        </button>
      </div>

      <!-- MENSAJE SI NO HAY JUEGOS -->
      <div id="noGamesMessage" style="text-align:center;padding:60px 20px;color:var(--muted);display:none">
        <div style="font-size:48px;margin-bottom:16px">üéÆ</div>
        <h3>A√∫n no hay juegos publicados</h3>
        <p>¬°S√© el primero en publicar un juego indie en Pyxolotl!</p>
        <a href="publicar-juego.html" id="noGamesPublishBtn" class="btn" style="margin-top:20px;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a">
          Publicar mi juego
        </a>
      </div>

      <!-- LOADER -->
      <div id="gamesLoader" style="text-align:center;padding:40px">
        <div style="display:inline-block;width:40px;height:40px;border:4px solid rgba(255,255,255,0.1);border-top-color:var(--accent-1);border-radius:50%;animation:spin 1s linear infinite"></div>
        <p style="margin-top:16px;color:var(--muted)">Cargando juegos...</p>
      </div>
    </section>

  </main>

  <!-- ============================================ -->
  <!-- FOOTER PROFESIONAL - PYXOLOTL -->
  <!-- ============================================ -->

  <footer id="about" class="pyxolotl-footer">
    <div class="footer-container">
      <!-- Columna 1: Informaci√≥n de Pyxolotl -->
      <div class="footer-column">
        <h3 class="footer-title">PYXOLOTL</h3>
        <p class="footer-description">
          Plataforma mexicana de videojuegos indie. 
          Conectando desarrolladores con jugadores apasionados.
        </p>
        <!-- Redes sociales -->
        <div class="footer-social">
          <a href="https://www.instagram.com/pyxo.lotl?igsh=OHRybW00NHA4Nnc4" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="social-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
              <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z" fill="none" stroke="#07102a" stroke-width="2"/>
              <line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke="#07102a" stroke-width="2"/>
            </svg>
          </a>
          <a href="https://www.facebook.com/profile.php?id=61584296583769" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="social-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Columna 2: Para Desarrolladores -->
      <div class="footer-column">
        <h4 class="footer-heading">DESARROLLADORES</h4>
        <ul class="footer-links">
          <li><a href="publicar-juego.html" id="footerPublishLink">Publicar juego</a></li>
          <li><a href="#about">Acerca de Pyxolotl</a></li>
        </ul>
      </div>

      <!-- Columna 3: Ayuda -->
      <div class="footer-column">
        <h4 class="footer-heading">AYUDA</h4>
        <ul class="footer-links">
          <li><a href="faq.html">Preguntas frecuentes</a></li>
          <li><a href="mailto:soporte@pyxolotl.com">Soporte</a></li>
          <li><a href="#" onclick="openTermsModal(event)">T√©rminos y condiciones</a></li>
          <li><a href="#" onclick="openPrivacyModal(event)">Privacidad</a></li>
        </ul>
      </div>

      <!-- Columna 4: Pyxolotl -->
      <div class="footer-column">
        <h4 class="footer-heading">PYXOLOTL</h4>
        <ul class="footer-links">
          <li><a href="biblioteca.html">Mi biblioteca</a></li>
          <li><a href="inicio.html#registro">Registrarse</a></li>
          <li><a href="inicio.html">Iniciar sesi√≥n</a></li>
        </ul>
      </div>
    </div>

    <!-- Copyright y legal -->
    <div class="footer-bottom">
      <div class="footer-container">
        <p class="footer-copyright">
          ¬© 2025 Pyxolotl. Todos los derechos reservados.
        </p>
        <div class="footer-legal">
          <a href="#" onclick="openPrivacyModal(event)">Privacidad</a>
          <span class="separator">¬∑</span>
          <a href="#" onclick="openTermsModal(event)">T√©rminos</a>
          <span class="separator">¬∑</span>
          <a href="faq.html">FAQ</a>
        </div>
      </div>
    </div>
  </footer>

  <style>
    .pyxolotl-footer {
      background: linear-gradient(180deg, #0a0e1a 0%, #07102a 100%);
      border-top: 1px solid rgba(123, 97, 255, 0.1);
      padding: 60px 0 0 0;
      margin-top: 100px;
      color: #e0e0e0;
    }

    .footer-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 40px;
      display: grid;
      grid-template-columns: 1.5fr repeat(3, 1fr);
      gap: 50px;
    }

    .footer-column {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .footer-title {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .footer-description {
      color: #b0b0b0;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    .footer-social {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .social-link {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(123, 97, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-1);
      transition: all 0.3s ease;
      border: 1px solid rgba(123, 97, 255, 0.2);
    }

    .social-link:hover {
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      color: #07102a;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(123, 97, 255, 0.4);
    }

    .footer-heading {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1.5px;
      color: #808080;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .footer-links {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .footer-links li a {
      color: #b0b0b0;
      font-size: 14px;
      text-decoration: none;
      transition: all 0.2s ease;
      display: inline-block;
    }

    .footer-links li a:hover {
      color: var(--accent-1);
      transform: translateX(4px);
    }

    .footer-bottom {
      background: #060a16;
      border-top: 1px solid rgba(123, 97, 255, 0.1);
      padding: 24px 0;
      margin-top: 50px;
    }

    .footer-bottom .footer-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      grid-template-columns: 1fr;
    }

    .footer-copyright {
      color: #808080;
      font-size: 13px;
      margin: 0;
    }

    .footer-legal {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .footer-legal a {
      color: #808080;
      font-size: 13px;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .footer-legal a:hover {
      color: var(--accent-1);
    }

    .footer-legal .separator {
      color: #404040;
    }

    @media (max-width: 1024px) {
      .footer-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 40px;
      }

      .footer-column:first-child {
        grid-column: 1 / -1;
        text-align: center;
      }

      .footer-social {
        justify-content: center;
      }
    }

    @media (max-width: 768px) {
      .pyxolotl-footer {
        padding: 40px 0 0 0;
        margin-top: 60px;
      }

      .footer-container {
        grid-template-columns: 1fr;
        gap: 30px;
        padding: 0 20px;
      }

      .footer-column:first-child {
        text-align: center;
      }

      .footer-title {
        font-size: 20px;
      }

      .footer-description {
        font-size: 13px;
      }

      .footer-bottom .footer-container {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }

      .footer-legal {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
  </style>
  <!-- MODAL CARRITO -->
  <div id="cartModal" class="modal">
    <div class="panel" style="max-width:600px">
      <button class="close-cart" style="float:right;background:transparent;border:none;color:var(--muted);font-size:18px;cursor:pointer">‚úï</button>
      <h3>üõí Tu Carrito</h3>
      
      <div id="cartItems" style="margin-top:20px;max-height:300px;overflow-y:auto"></div>

      <div id="cartEmpty" style="text-align:center;padding:40px;color:var(--muted)">
        El carrito est√° vac√≠o
      </div>

      <div id="cartSummary" style="margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);display:none">
        <div style="display:flex;justify-content:space-between;margin-bottom:12px">
          <span>Subtotal:</span>
          <span id="subtotal">$0.00</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:12px">
          <span>IVA (16%):</span>
          <span id="tax">$0.00</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:20px;font-weight:700;color:var(--accent-1)">
          <span>Total:</span>
          <span id="total">$0.00</span>
        </div>
      </div>

      <button id="checkoutBtn" class="btn" style="width:100%;margin-top:20px;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a;font-weight:700;display:none">
        Proceder al pago
      </button>
    </div>
  </div>

  <!-- MODAL DE PERFIL -->
  <div id="profileModal" class="modal">
    <div class="panel" style="max-width:700px">
      <button class="close-profile" style="float:right;background:transparent;border:none;color:var(--muted);font-size:18px;cursor:pointer">‚úï</button>
      <h2>üë§ Mi Perfil</h2>
      
      <div style="margin-top:24px">
        <!-- Avatar grande con opci√≥n de cambiar -->
        <div style="text-align:center;margin-bottom:30px">
          <div id="profileAvatarLarge" class="profile-avatar-large">
            <span id="profileInitialsLarge">U</span>
          </div>
          <div style="margin-top:16px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
            <label for="avatarUpload" class="btn" style="background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a;cursor:pointer">
              üì∑ Cambiar foto
            </label>
            <button id="removeAvatarBtn" class="btn btn-ghost" style="display:none">
              üóëÔ∏è Eliminar foto
            </button>
            <input type="file" id="avatarUpload" accept="image/*" style="display:none">
          </div>
          <div id="uploadProgress" style="display:none;margin-top:10px;color:var(--accent-1)">
            Procesando imagen...
          </div>
        </div>

        <!-- Informaci√≥n del perfil -->
        <div style="display:grid;gap:20px">
          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Nombre de usuario</label>
            <input type="text" id="profileNameInput" class="profile-input" placeholder="Tu nombre">
          </div>

          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Correo electr√≥nico</label>
            <input type="email" id="profileEmailInput" class="profile-input" readonly style="opacity:0.6;cursor:not-allowed">
          </div>

          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Tipo de cuenta</label>
            <input type="text" id="profileTypeInput" class="profile-input" readonly style="opacity:0.6;cursor:not-allowed">
          </div>

          <div>
            <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Biograf√≠a</label>
            <textarea id="profileBioInput" class="profile-input" rows="4" placeholder="Cu√©ntanos sobre ti..." style="resize:vertical"></textarea>
          </div>

          <!-- Secci√≥n de cambio de contrase√±a -->
          <div style="margin-top:20px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1)">
            <h3 style="margin-bottom:16px;font-size:18px">üîí Cambiar Contrase√±a</h3>
            <div id="passwordSection">
              <button id="showPasswordChangeBtn" class="btn btn-ghost" style="width:100%">
                Cambiar mi contrase√±a
              </button>
              
              <div id="passwordChangeForm" style="display:none;margin-top:16px">
                <div style="margin-bottom:12px">
                  <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Contrase√±a actual</label>
                  <input type="password" id="currentPassword" class="profile-input" placeholder="Ingresa tu contrase√±a actual">
                </div>
                <div style="margin-bottom:12px">
                  <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Nueva contrase√±a</label>
                  <input type="password" id="newPassword" class="profile-input" placeholder="M√≠nimo 8 caracteres" minlength="8">
                </div>
                <div style="margin-bottom:12px">
                  <label style="display:block;margin-bottom:8px;color:var(--muted);font-size:14px">Confirmar nueva contrase√±a</label>
                  <input type="password" id="confirmPassword" class="profile-input" placeholder="Repite la nueva contrase√±a">
                </div>
                <div style="display:flex;gap:8px">
                  <button id="changePasswordBtn" class="btn" style="flex:1;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a;font-weight:600">
                    Cambiar contrase√±a
                  </button>
                  <button id="cancelPasswordBtn" class="btn btn-ghost" style="flex:1">
                    Cancelar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Botones de acci√≥n -->
        <div style="display:flex;gap:12px;margin-top:24px">
          <button id="saveProfileBtn" class="btn" style="flex:1;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a;font-weight:600">
            üíæ Guardar cambios
          </button>
          <button class="btn btn-ghost close-profile" style="flex:1">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    #userName {
      font-weight: 600;
      color: var(--accent-1);
    }
    
    /* Avatar del usuario */
    .user-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #07102a;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 3px solid rgba(255,255,255,0.1);
      overflow: hidden;
    }
    
    .user-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(123,97,255,0.3);
    }
    
    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Avatar grande en el modal */
    .profile-avatar-large {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #07102a;
      font-size: 40px;
      border: 4px solid rgba(255,255,255,0.1);
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(123,97,255,0.3);
    }
    
    .profile-avatar-large img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* Inputs del perfil */
    .profile-input {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--glass);
      color: #fff;
      font-size: 15px;
      font-family: inherit;
      transition: border-color 0.2s;
    }
    
    .profile-input:focus {
      outline: none;
      border-color: var(--accent-1);
    }
    
    .profile-input::placeholder {
      color: var(--muted);
    }
  </style>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="api.js"></script>
  <script src="cart.js"></script>
  <!-- ============================================ -->
  <!-- MODAL DE PRIVACIDAD -->
  <!-- ============================================ -->
  <div id="privacyModal" class="legal-modal">
    <div class="legal-modal-overlay" onclick="closePrivacyModal()"></div>
    <div class="legal-modal-content">
      <button class="legal-modal-close" onclick="closePrivacyModal()" aria-label="Cerrar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <div class="legal-modal-header">
        <h2 class="legal-modal-title">Aviso de Privacidad ‚Äì Pyxolotl</h2>
        <p class="legal-modal-subtitle">√öltima actualizaci√≥n: Noviembre 2025</p>
      </div>
      <div class="legal-modal-body">
        <p>En Pyxolotl, respetamos tu privacidad y nos comprometemos a proteger tus datos personales. Esta Pol√≠tica de Privacidad explica c√≥mo recopilamos, usamos y protegemos tu informaci√≥n.</p>
        
        <h3>1. Informaci√≥n que Recopilamos</h3>
        <p><strong>Informaci√≥n de cuenta:</strong></p>
        <ul>
          <li>Nombre de usuario y correo electr√≥nico</li>
          <li>Contrase√±a (encriptada)</li>
          <li>Fecha de registro</li>
          <li>Pa√≠s/regi√≥n</li>
        </ul>
        
        <p><strong>Informaci√≥n de compra:</strong></p>
        <ul>
          <li>Historial de transacciones</li>
          <li>M√©todos de pago (procesados de forma segura)</li>
          <li>Juegos adquiridos</li>
        </ul>
        
        <p><strong>Informaci√≥n de desarrollador:</strong></p>
        <ul>
          <li>Datos fiscales (para desarrolladores que publican juegos)</li>
          <li>Informaci√≥n bancaria para pagos</li>
          <li>Estad√≠sticas de ventas</li>
        </ul>
        
        <p><strong>Datos t√©cnicos:</strong></p>
        <ul>
          <li>Direcci√≥n IP</li>
          <li>Tipo de navegador y dispositivo</li>
          <li>Cookies y datos de uso de la plataforma</li>
        </ul>
        
        <h3>2. C√≥mo Usamos tu Informaci√≥n</h3>
        <ul>
          <li>Gestionar tu cuenta y acceso a juegos</li>
          <li>Procesar compras y pagos</li>
          <li>Enviar confirmaciones de compra</li>
          <li>Mejorar la experiencia de usuario en la plataforma</li>
          <li>Prevenir fraudes y garantizar la seguridad</li>
          <li>Proporcionar soporte t√©cnico</li>
        </ul>
        
        <h3>3. Compartir Informaci√≥n</h3>
        <p>No vendemos tus datos personales a terceros. Compartimos informaci√≥n √∫nicamente con:</p>
        <ul>
          <li><strong>Procesadores de pago:</strong> Para gestionar transacciones de forma segura</li>
          <li><strong>Desarrolladores:</strong> Estad√≠sticas an√≥nimas de ventas y jugadores</li>
          <li><strong>Servicios t√©cnicos:</strong> Hosting y servicios esenciales para el funcionamiento de la plataforma</li>
          <li><strong>Autoridades legales:</strong> Cuando sea requerido por ley</li>
        </ul>
        
        <h3>4. Cookies y Tecnolog√≠as Similares</h3>
        <p>Utilizamos cookies para:</p>
        <ul>
          <li>Mantener tu sesi√≥n iniciada</li>
          <li>Recordar preferencias</li>
          <li>Analizar el uso de la plataforma</li>
          <li>Mejorar la seguridad</li>
        </ul>
        <p>Puedes gestionar las cookies desde la configuraci√≥n de tu navegador.</p>
        
        <h3>5. Seguridad de los Datos</h3>
        <p>Implementamos medidas de seguridad t√©cnicas y organizativas para proteger tus datos:</p>
        <ul>
          <li>Encriptaci√≥n SSL/TLS</li>
          <li>Contrase√±as hasheadas</li>
          <li>Autenticaci√≥n segura</li>
          <li>Servidores protegidos</li>
        </ul>
        
        <h3>6. Tus Derechos</h3>
        <p>Tienes derecho a:</p>
        <ul>
          <li>Acceder a tus datos personales</li>
          <li>Corregir informaci√≥n incorrecta</li>
          <li>Solicitar la eliminaci√≥n de tu cuenta</li>
          <li>Exportar tus datos</li>
          <li>Revocar consentimientos</li>
          <li>Oponerte al procesamiento de datos</li>
        </ul>
        <p>Para ejercer estos derechos, cont√°ctanos en: <a href="mailto:privacidad@pyxolotl.com">privacidad@pyxolotl.com</a></p>
        
        <h3>7. Retenci√≥n de Datos</h3>
        <p>Conservamos tus datos mientras tu cuenta est√© activa. Si eliminas tu cuenta, conservaremos datos esenciales solo por el tiempo necesario para cumplir obligaciones legales (historial de compras, datos fiscales).</p>
        
        <h3>8. Menores de Edad</h3>
        <p>Pyxolotl est√° destinado a mayores de 13 a√±os. Si eres menor de 18 a√±os, necesitas el consentimiento de tus padres o tutores para usar la plataforma.</p>
        
        <h3>9. Cambios en esta Pol√≠tica</h3>
        <p>Podemos actualizar esta pol√≠tica ocasionalmente. Te notificaremos de cambios importantes por correo electr√≥nico o mediante un aviso en la plataforma.</p>
        
        <h3>10. Contacto</h3>
        <p>Para preguntas sobre privacidad, escr√≠benos a:</p>
        <ul>
          <li>Email: <a href="mailto:privacidad@pyxolotl.com">privacidad@pyxolotl.com</a></li>
          <li>Correo general: <a href="mailto:contacto@pyxolotl.com">contacto@pyxolotl.com</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- MODAL DE T√âRMINOS Y CONDICIONES -->
  <!-- ============================================ -->
  <div id="termsModal" class="legal-modal">
    <div class="legal-modal-overlay" onclick="closeTermsModal()"></div>
    <div class="legal-modal-content">
      <button class="legal-modal-close" onclick="closeTermsModal()" aria-label="Cerrar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <div class="legal-modal-header">
        <h2 class="legal-modal-title">T√©rminos y Condiciones de Uso ‚Äì Pyxolotl</h2>
        <p class="legal-modal-subtitle">√öltima actualizaci√≥n: Noviembre 2025</p>
      </div>
      <div class="legal-modal-body">
        <p>Bienvenido a Pyxolotl. Al usar nuestra plataforma, aceptas estos T√©rminos y Condiciones. Por favor, l√©elos cuidadosamente.</p>
        
        <h3>1. Aceptaci√≥n de los T√©rminos</h3>
        <p>Al crear una cuenta, comprar o descargar juegos, o usar cualquier servicio de Pyxolotl, aceptas estar legalmente vinculado a estos t√©rminos.</p>
        
        <h3>2. Descripci√≥n del Servicio</h3>
        <p>Pyxolotl es una plataforma digital que conecta desarrolladores indie de videojuegos con jugadores. Ofrecemos:</p>
        <ul>
          <li>Venta y distribuci√≥n de videojuegos indie</li>
          <li>Herramientas para desarrolladores</li>
          <li>Sistema de pagos seguro</li>
          <li>Comunidad de desarrolladores y jugadores</li>
        </ul>
        
        <h3>3. Cuentas de Usuario</h3>
        <p><strong>Registro:</strong></p>
        <ul>
          <li>Debes proporcionar informaci√≥n veraz y actualizada</li>
          <li>Eres responsable de mantener la seguridad de tu cuenta</li>
          <li>No puedes compartir tu cuenta con terceros</li>
          <li>Debes tener al menos 13 a√±os para registrarte</li>
        </ul>
        <p><strong>Responsabilidades:</strong></p>
        <ul>
          <li>Mantener la confidencialidad de tu contrase√±a</li>
          <li>Notificarnos inmediatamente de cualquier uso no autorizado</li>
          <li>No usar la cuenta para actividades ilegales o fraudulentas</li>
        </ul>
        
        <h3>4. Compra de Juegos</h3>
        <p><strong>Licencias:</strong></p>
        <ul>
          <li>Al comprar un juego, adquieres una licencia de uso personal, no comercial</li>
          <li>La licencia es intransferible (no puedes revender)</li>
          <li>Puedes descargar e instalar el juego en tus dispositivos personales</li>
        </ul>
        <p><strong>Precios y Pagos:</strong></p>
        <ul>
          <li>Los precios est√°n en pesos mexicanos (MXN) y pueden incluir impuestos</li>
          <li>Los pagos se procesan de forma segura a trav√©s de servicios de terceros</li>
          <li>Los desarrolladores establecen los precios de sus juegos</li>
          <li>Todas las ventas son finales</li>
        </ul>
        
        <h3>5. Para Desarrolladores</h3>
        <p><strong>Publicaci√≥n de Juegos:</strong></p>
        <ul>
          <li>Debes tener los derechos completos sobre el contenido que publicas</li>
          <li>Garantizas que tu juego no infringe derechos de terceros</li>
          <li>Debes cumplir con las leyes aplicables y las pol√≠ticas de contenido</li>
        </ul>
        <p><strong>Comisiones:</strong></p>
        <ul>
          <li>Pyxolotl retiene un 15% del precio de venta de cada juego</li>
          <li>Eres responsable de tus obligaciones fiscales</li>
        </ul>
        <p><strong>Contenido Prohibido:</strong></p>
        <ul>
          <li>Contenido ilegal, difamatorio o que incite al odio</li>
          <li>Malware, virus o software malicioso</li>
          <li>Contenido que viole derechos de propiedad intelectual</li>
          <li>Material sexual expl√≠cito sin advertencias adecuadas</li>
        </ul>
        
        <h3>6. Propiedad Intelectual</h3>
        <p><strong>Plataforma:</strong></p>
        <ul>
          <li>Pyxolotl y todos sus elementos (logo, dise√±o, c√≥digo) son propiedad de Pyxolotl</li>
          <li>No puedes reproducir, modificar o distribuir la plataforma</li>
        </ul>
        <p><strong>Juegos:</strong></p>
        <ul>
          <li>Los desarrolladores mantienen todos los derechos sobre sus juegos</li>
          <li>Los jugadores obtienen licencias limitadas de uso</li>
        </ul>
        
        <h3>7. Conducta del Usuario</h3>
        <p>Est√° prohibido:</p>
        <ul>
          <li>Hackear, explotar vulnerabilidades o manipular la plataforma</li>
          <li>Usar bots o automatizaci√≥n no autorizada</li>
          <li>Acosar, amenazar o abusar de otros usuarios</li>
          <li>Hacer spam o publicidad no autorizada</li>
          <li>Realizar transacciones fraudulentas</li>
          <li>Compartir contenido inapropiado en comentarios o rese√±as</li>
        </ul>
        
        <h3>8. Modificaci√≥n y Cancelaci√≥n del Servicio</h3>
        <p><strong>Modificaciones:</strong></p>
        <ul>
          <li>Podemos actualizar, modificar o discontinuar caracter√≠sticas de la plataforma</li>
          <li>Te notificaremos de cambios importantes con antelaci√≥n</li>
        </ul>
        <p><strong>Suspensi√≥n de Cuenta:</strong> Podemos suspender o cancelar tu cuenta si:</p>
        <ul>
          <li>Violas estos t√©rminos</li>
          <li>Realizas actividades fraudulentas</li>
          <li>Infringes derechos de terceros</li>
        </ul>
        
        <h3>9. Limitaci√≥n de Responsabilidad</h3>
        <p>Pyxolotl no se hace responsable por:</p>
        <ul>
          <li>Problemas t√©cnicos de los juegos (responsabilidad del desarrollador)</li>
          <li>P√©rdida de datos por causas ajenas a nosotros</li>
          <li>Interrupciones del servicio por mantenimiento o causas de fuerza mayor</li>
          <li>Contenido generado por usuarios</li>
        </ul>
        
        <h3>10. Resoluci√≥n de Disputas</h3>
        <ul>
          <li>En caso de controversias, intentaremos resolverlas de forma amistosa</li>
          <li>Si no es posible, se someter√°n a la jurisdicci√≥n de los tribunales de M√©xico</li>
          <li>Estos t√©rminos se rigen por las leyes mexicanas</li>
        </ul>
        
        <h3>11. Divisibilidad</h3>
        <p>Si alguna cl√°usula es considerada inv√°lida, el resto de los t√©rminos permanece en vigor.</p>
        
        <h3>12. Contacto</h3>
        <p>Para preguntas sobre estos t√©rminos:</p>
        <ul>
          <li>Email: <a href="mailto:legal@pyxolotl.com">legal@pyxolotl.com</a></li>
          <li>Correo general: <a href="mailto:contacto@pyxolotl.com">contacto@pyxolotl.com</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- MODAL DE DETALLES DEL JUEGO -->
  <!-- ============================================ -->
  <div id="gameDetailModal" class="game-detail-modal">
    <div class="game-detail-content">
      <button class="game-detail-close" onclick="closeGameDetailModal()">&times;</button>
      
      <!-- Hero Image -->
      <div class="game-detail-hero">
        <div id="gameDetailHero" class="game-detail-hero-placeholder">
          <span id="gameDetailHeroText">??</span>
        </div>
        <div class="game-detail-hero-overlay"></div>
      </div>
      
      <!-- Body -->
      <div class="game-detail-body">
        <!-- Header con t√≠tulo y precio -->
        <div class="game-detail-header">
          <div>
            <h1 id="gameDetailTitle" class="game-detail-title">T√≠tulo del Juego</h1>
            <div class="game-detail-meta">
              <span id="gameDetailGenre" class="game-detail-genre">G√©nero</span>
              <div class="game-detail-rating">
                <span id="gameDetailStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                <span>(<span id="gameDetailReviews">0</span> rese√±as)</span>
              </div>
            </div>
          </div>
          <div class="game-detail-price-box">
            <div id="gameDetailPrice" class="game-detail-price">$0.00 MXN</div>
          </div>
        </div>
        
        <!-- Estad√≠sticas -->
        <div class="game-detail-stats">
          <div class="game-detail-stat">
            <div id="gameDetailDownloads" class="game-detail-stat-value">0</div>
            <div class="game-detail-stat-label">Descargas</div>
          </div>
          <div class="game-detail-stat">
            <div id="gameDetailSales" class="game-detail-stat-value">0</div>
            <div class="game-detail-stat-label">Ventas</div>
          </div>
          <div class="game-detail-stat">
            <div id="gameDetailRating" class="game-detail-stat-value">0.0</div>
            <div class="game-detail-stat-label">Calificaci√≥n</div>
          </div>
          <div class="game-detail-stat">
            <div id="gameDetailSize" class="game-detail-stat-value">--</div>
            <div class="game-detail-stat-label">Tama√±o</div>
          </div>
        </div>
        
        <!-- Desarrollador -->
        <div class="game-detail-developer">
          <div id="gameDetailDevAvatar" class="game-detail-developer-avatar">??</div>
          <div class="game-detail-developer-info">
            <h4 id="gameDetailDevName">Desarrollador</h4>
            <p>Desarrollador Indie</p>
          </div>
        </div>
        
        <!-- Screenshots Gallery -->
        <div id="gameDetailScreenshots" class="game-detail-screenshots" style="display:none;">
          <h3>üñºÔ∏è Capturas de pantalla</h3>
          <div class="screenshots-gallery" id="screenshotsGallery">
            <!-- Se llenan din√°micamente -->
          </div>
        </div>
        
        <!-- Descripci√≥n -->
        <div class="game-detail-description">
          <h3>üìñ Acerca del juego</h3>
          <p id="gameDetailDesc">Descripci√≥n del juego...</p>
        </div>
        
        <!-- Requisitos del Sistema -->
        <div id="gameDetailRequirements" class="game-detail-requirements" style="display:none;">
          <h3>üñ•Ô∏è Requisitos del Sistema</h3>
          <div class="requirements-container">
            <div class="requirements-column">
              <h4>M√çNIMO</h4>
              <div id="gameDetailReqMin" class="requirements-list"></div>
            </div>
            <div class="requirements-column">
              <h4>RECOMENDADO</h4>
              <div id="gameDetailReqRec" class="requirements-list"></div>
            </div>
          </div>
        </div>
        
        <!-- Rese√±as -->
        <div class="game-detail-reviews-section">
          <h3>üí¨ Rese√±as de usuarios</h3>
          
          <!-- Formulario para escribir rese√±a -->
          <div id="gameDetailReviewForm" class="review-form-container" style="display:none;">
            <h4>‚úçÔ∏è Escribe tu rese√±a</h4>
            <div class="review-form">
              <div class="review-rating-select">
                <span>Tu calificaci√≥n:</span>
                <div class="star-rating" id="gameDetailStarRating">
                  <span class="star" data-rating="1">‚òÜ</span>
                  <span class="star" data-rating="2">‚òÜ</span>
                  <span class="star" data-rating="3">‚òÜ</span>
                  <span class="star" data-rating="4">‚òÜ</span>
                  <span class="star" data-rating="5">‚òÜ</span>
                </div>
                <span id="gameDetailRatingText" class="rating-text">Selecciona una calificaci√≥n</span>
              </div>
              <textarea id="gameDetailReviewText" class="review-textarea" placeholder="¬øQu√© te pareci√≥ este juego? Comparte tu experiencia..." maxlength="1000"></textarea>
              <div class="review-form-actions">
                <span id="gameDetailCharCount" class="char-count">0/1000</span>
                <button class="btn review-submit-btn" onclick="submitGameReview()">
                  üì§ Publicar rese√±a
                </button>
              </div>
            </div>
          </div>
          
          <!-- Mensaje para usuarios no autenticados -->
          <div id="gameDetailReviewLoginPrompt" class="review-login-prompt" style="display:none;">
            <p>üîí Inicia sesi√≥n para dejar una rese√±a</p>
            <a href="inicio.html" class="btn btn-small">Iniciar sesi√≥n</a>
          </div>
          
          <!-- Lista de rese√±as -->
          <div id="gameDetailReviewsList" class="reviews-list">
            <div class="reviews-loading">Cargando rese√±as...</div>
          </div>
        </div>
        
        <!-- Acciones -->
        <div class="game-detail-actions">
          <button id="gameDetailActionBtn" class="btn game-detail-btn-primary" onclick="handleGameDetailAction()">
            üõí Agregar al carrito
          </button>
          <button class="btn game-detail-btn-secondary" onclick="closeGameDetailModal()">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- MODAL DE CONFIRMACI√ìN CERRAR SESI√ìN -->
  <!-- ============================================ -->
  <div id="logoutModal" class="logout-modal">
    <div class="logout-modal-overlay" onclick="closeLogoutModal()"></div>
    <div class="logout-modal-content">
      <div class="logout-modal-icon">üëã</div>
      <h2>¬øCerrar sesi√≥n?</h2>
      <p>¬øEst√°s seguro de que deseas cerrar tu sesi√≥n en Pyxolotl?</p>
      <div class="logout-modal-actions">
        <button class="btn logout-btn-cancel" onclick="closeLogoutModal()">Cancelar</button>
        <button class="btn logout-btn-confirm" onclick="confirmLogout()">S√≠, cerrar sesi√≥n</button>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- ESTILOS DE LOS MODALES LEGALES -->
  <!-- ============================================ -->
  <style>
    /* Modal Legal Base */
    .legal-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .legal-modal.active {
      display: flex;
    }

    /* Overlay */
    .legal-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }

    /* Contenido del Modal */
    .legal-modal-content {
      position: relative;
      background: #0f1218;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      max-height: 85vh;
      overflow: hidden;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(123, 97, 255, 0.15);
      animation: slideUp 0.4s ease;
      display: flex;
      flex-direction: column;
    }

    /* Bot√≥n de Cerrar */
    .legal-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }

    .legal-modal-close svg {
      stroke: var(--muted);
      transition: stroke 0.2s ease;
    }

    .legal-modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent-1);
    }

    .legal-modal-close:hover svg {
      stroke: var(--accent-1);
    }

    /* Header del Modal */
    .legal-modal-header {
      padding: 30px 30px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      flex-shrink: 0;
    }

    .legal-modal-title {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 8px;
      color: #fff;
      padding-right: 40px;
    }

    .legal-modal-subtitle {
      font-size: 14px;
      color: var(--muted);
      margin: 0;
    }

    /* Cuerpo del Modal */
    .legal-modal-body {
      padding: 24px 30px 30px;
      overflow-y: auto;
      flex: 1;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.7;
    }

    .legal-modal-body h3 {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      margin: 24px 0 12px;
    }

    .legal-modal-body h3:first-child {
      margin-top: 0;
    }

    .legal-modal-body p {
      margin: 0 0 12px;
    }

    .legal-modal-body ul,
    .legal-modal-body ol {
      margin: 8px 0 16px;
      padding-left: 24px;
    }

    .legal-modal-body li {
      margin-bottom: 6px;
    }

    .legal-modal-body strong {
      color: #e0e0e0;
    }

    .legal-modal-body a {
      color: var(--accent-1);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .legal-modal-body a:hover {
      color: var(--accent-2);
      text-decoration: underline;
    }

    /* Scrollbar personalizado */
    .legal-modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .legal-modal-body::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 4px;
    }

    .legal-modal-body::-webkit-scrollbar-thumb {
      background: rgba(123, 97, 255, 0.3);
      border-radius: 4px;
    }

    .legal-modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(123, 97, 255, 0.5);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .legal-modal {
        padding: 10px;
      }

      .legal-modal-content {
        max-height: 90vh;
        border-radius: 12px;
      }

      .legal-modal-header {
        padding: 24px 20px 16px;
      }

      .legal-modal-title {
        font-size: 18px;
      }

      .legal-modal-body {
        padding: 20px;
        font-size: 13px;
      }

      .legal-modal-body h3 {
        font-size: 15px;
      }

      .legal-modal-close {
        top: 12px;
        right: 12px;
        width: 36px;
        height: 36px;
      }
    }

    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Prevenir scroll del body cuando modal est√° abierto */
    body.modal-open {
      overflow: hidden;
    }

    /* ========== MODAL DE DETALLES DEL JUEGO ========== */
    .game-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }

    .game-detail-modal.active {
      display: flex;
    }

    .game-detail-content {
      background: linear-gradient(180deg, #0d1526 0%, #07102a 100%);
      border-radius: 24px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      border: 1px solid rgba(123, 97, 255, 0.2);
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .game-detail-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }

    .game-detail-close:hover {
      background: rgba(255, 71, 87, 0.8);
      transform: rotate(90deg);
    }

    .game-detail-hero {
      position: relative;
      height: 300px;
      overflow: hidden;
      border-radius: 24px 24px 0 0;
    }

    .game-detail-hero-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .game-detail-hero-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
      font-weight: bold;
      color: #07102a;
    }

    .game-detail-hero-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 150px;
      background: linear-gradient(transparent, #0d1526);
    }

    .game-detail-body {
      padding: 30px;
    }

    .game-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .game-detail-title {
      font-size: 32px;
      font-weight: 700;
      margin: 0 0 8px 0;
      background: linear-gradient(90deg, #fff, #e0e0e0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .game-detail-meta {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .game-detail-genre {
      background: rgba(123, 97, 255, 0.2);
      color: var(--accent-1);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }

    .game-detail-rating {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #ffc107;
      font-size: 16px;
    }

    .game-detail-rating span {
      color: var(--muted);
      font-size: 14px;
    }

    .game-detail-price-box {
      text-align: right;
    }

    .game-detail-price {
      font-size: 36px;
      font-weight: 700;
      color: #4CAF50;
    }

    .game-detail-price.free {
      background: linear-gradient(90deg, #43e97b, #38f9d7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .game-detail-description {
      margin-bottom: 30px;
    }

    .game-detail-description h3 {
      font-size: 18px;
      margin-bottom: 12px;
      color: #fff;
    }

    .game-detail-description p {
      color: var(--muted);
      line-height: 1.8;
      font-size: 15px;
    }

    .game-detail-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(123, 97, 255, 0.05);
      border-radius: 16px;
      border: 1px solid rgba(123, 97, 255, 0.1);
    }

    .game-detail-stat {
      text-align: center;
    }

    .game-detail-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-1);
    }

    .game-detail-stat-label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .game-detail-developer {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      margin-bottom: 24px;
    }

    .game-detail-developer-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #07102a;
    }

    .game-detail-developer-info h4 {
      margin: 0;
      font-size: 16px;
      color: #fff;
    }

    .game-detail-developer-info p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .game-detail-actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .game-detail-actions .btn {
      flex: 1;
      min-width: 200px;
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .game-detail-btn-primary {
      background: linear-gradient(90deg, var(--accent-2), var(--accent-1));
      color: #07102a;
      border: none;
    }

    .game-detail-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(123, 97, 255, 0.4);
    }

    .game-detail-btn-download {
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: #07102a;
      border: none;
    }

    .game-detail-btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(67, 233, 123, 0.4);
    }

    .game-detail-btn-secondary {
      background: transparent;
      border: 2px solid var(--accent-1);
      color: var(--accent-1);
    }

    .game-detail-btn-secondary:hover {
      background: var(--accent-1);
      color: #07102a;
    }

    /* Scrollbar del modal */
    .game-detail-content::-webkit-scrollbar {
      width: 8px;
    }

    .game-detail-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    .game-detail-content::-webkit-scrollbar-thumb {
      background: var(--accent-1);
      border-radius: 4px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .game-detail-content {
        max-height: 95vh;
        border-radius: 16px;
      }

      .game-detail-hero {
        height: 200px;
        border-radius: 16px 16px 0 0;
      }

      .game-detail-body {
        padding: 20px;
      }

      .game-detail-header {
        flex-direction: column;
      }

      .game-detail-price-box {
        text-align: left;
      }

      .game-detail-title {
        font-size: 24px;
      }

      .game-detail-actions {
        flex-direction: column;
      }

      .game-detail-actions .btn {
        min-width: 100%;
      }
    }

    /* ========== REQUISITOS DEL SISTEMA ========== */
    .game-detail-requirements {
      margin-bottom: 30px;
      padding: 24px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      border: 1px solid rgba(123, 97, 255, 0.15);
    }

    .game-detail-requirements h3 {
      font-size: 18px;
      margin-bottom: 20px;
      color: #fff;
    }

    .requirements-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .requirements-column h4 {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-1);
      letter-spacing: 1px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(123, 97, 255, 0.2);
    }

    .requirements-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .requirement-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .requirement-label {
      font-size: 11px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .requirement-value {
      font-size: 14px;
      color: #e0e0e0;
      line-height: 1.4;
    }

    @media (max-width: 768px) {
      .requirements-container {
        grid-template-columns: 1fr;
        gap: 24px;
      }
    }

    /* ========== RESE√ëAS ========== */
    .game-detail-reviews-section {
      margin-bottom: 30px;
    }

    .game-detail-reviews-section h3 {
      font-size: 18px;
      margin-bottom: 20px;
      color: #fff;
    }

    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: 400px;
      overflow-y: auto;
      padding-right: 8px;
    }

    .reviews-list::-webkit-scrollbar {
      width: 6px;
    }

    .reviews-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .reviews-list::-webkit-scrollbar-thumb {
      background: var(--accent-1);
      border-radius: 3px;
    }

    .reviews-loading,
    .reviews-empty {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }

    .review-card {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }

    .review-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(123, 97, 255, 0.2);
    }

    .review-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .review-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #07102a;
      font-size: 14px;
      flex-shrink: 0;
    }

    .review-user-info {
      flex: 1;
      min-width: 0;
    }

    .review-user-name {
      font-weight: 600;
      color: #fff;
      font-size: 15px;
      margin-bottom: 2px;
    }

    .review-date {
      font-size: 12px;
      color: var(--muted);
    }

    .review-rating-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .review-rating-badge.positive {
      background: rgba(76, 175, 80, 0.15);
      color: #4CAF50;
    }

    .review-rating-badge.negative {
      background: rgba(255, 71, 87, 0.15);
      color: #ff4757;
    }

    .review-rating-badge.neutral {
      background: rgba(255, 193, 7, 0.15);
      color: #ffc107;
    }

    .review-content {
      color: #c0c0c0;
      font-size: 14px;
      line-height: 1.7;
    }

    .review-stars {
      color: #ffc107;
      font-size: 14px;
      margin-bottom: 8px;
    }

    /* ========== FORMULARIO DE RESE√ëAS ========== */
    .review-form-container {
      background: rgba(123, 97, 255, 0.05);
      border: 1px solid rgba(123, 97, 255, 0.2);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .review-form-container h4 {
      margin: 0 0 16px 0;
      font-size: 16px;
      color: #fff;
    }

    .review-rating-select {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .review-rating-select > span:first-child {
      color: var(--muted);
      font-size: 14px;
    }

    .star-rating {
      display: flex;
      gap: 4px;
    }

    .star-rating .star {
      font-size: 28px;
      cursor: pointer;
      color: #444;
      transition: all 0.2s ease;
    }

    .star-rating .star:hover,
    .star-rating .star.active {
      color: #ffc107;
      transform: scale(1.1);
    }

    .star-rating .star.hovered {
      color: #ffc107;
    }

    .rating-text {
      font-size: 13px;
      color: var(--accent-1);
      font-weight: 500;
    }

    .review-textarea {
      width: 100%;
      min-height: 100px;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.3);
      color: #fff;
      font-size: 14px;
      resize: vertical;
      font-family: inherit;
      transition: border-color 0.3s ease;
    }

    .review-textarea:focus {
      outline: none;
      border-color: var(--accent-1);
    }

    .review-textarea::placeholder {
      color: #666;
    }

    .review-form-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
    }

    .char-count {
      font-size: 12px;
      color: var(--muted);
    }

    .review-submit-btn {
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      color: #07102a;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .review-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(123, 97, 255, 0.4);
    }

    .review-submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .review-login-prompt {
      text-align: center;
      padding: 24px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .review-login-prompt p {
      color: var(--muted);
      margin-bottom: 12px;
    }

    .review-login-prompt .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      color: #07102a;
      border-radius: 6px;
      text-decoration: none;
    }

    /* ========== MODAL DE LOGOUT ========== */
    .logout-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 15000;
      align-items: center;
      justify-content: center;
    }

    .logout-modal.active {
      display: flex;
    }

    .logout-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }

    .logout-modal-content {
      position: relative;
      background: linear-gradient(180deg, #151c2c 0%, #0d1526 100%);
      border: 1px solid rgba(123, 97, 255, 0.3);
      border-radius: 24px;
      padding: 40px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      animation: logoutModalIn 0.3s ease;
      box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
    }

    @keyframes logoutModalIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .logout-modal-icon {
      font-size: 64px;
      margin-bottom: 20px;
      animation: wave 1s ease-in-out infinite;
    }

    @keyframes wave {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(20deg); }
      75% { transform: rotate(-20deg); }
    }

    .logout-modal-content h2 {
      font-size: 24px;
      color: #fff;
      margin-bottom: 12px;
    }

    .logout-modal-content p {
      color: var(--muted);
      font-size: 15px;
      margin-bottom: 28px;
      line-height: 1.5;
    }

    .logout-modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .logout-btn-cancel {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-btn-cancel:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .logout-btn-confirm {
      background: linear-gradient(90deg, #ff4757, #ff6b7a);
      border: none;
      color: #fff;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-btn-confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 71, 87, 0.4);
    }
  </style>

  <script>
    // ============================================
    // FUNCIONES PARA MODALES LEGALES (Privacidad y T√©rminos)
    // ============================================
    
    function openPrivacyModal(event) {
      if (event) event.preventDefault();
      const modal = document.getElementById('privacyModal');
      modal.classList.add('active');
      document.body.classList.add('modal-open');
    }
    
    function closePrivacyModal() {
      const modal = document.getElementById('privacyModal');
      modal.classList.remove('active');
      document.body.classList.remove('modal-open');
    }
    
    function openTermsModal(event) {
      if (event) event.preventDefault();
      const modal = document.getElementById('termsModal');
      modal.classList.add('active');
      document.body.classList.add('modal-open');
    }
    
    function closeTermsModal() {
      const modal = document.getElementById('termsModal');
      modal.classList.remove('active');
      document.body.classList.remove('modal-open');
    }
    
    // Cerrar modales con tecla Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closePrivacyModal();
        closeTermsModal();
        closeGameDetailModal();
      }
    });

    // ============================================
    // MODAL DE DETALLES DEL JUEGO
    // ============================================
    
    let currentGameDetail = null; // Almacena el juego actualmente mostrado en el modal
    let userBibliotecaIds = []; // IDs de juegos en la biblioteca del usuario
    let gameIsInLibrary = false; // Flag para saber si el juego actual est√° en biblioteca
    
    async function openGameDetailModal(gameId) {
      try {
        // Mostrar modal con loading
        const modal = document.getElementById('gameDetailModal');
        modal.classList.add('active');
        document.body.classList.add('modal-open');
        
        // Convertir gameId a n√∫mero para comparaci√≥n consistente
        const gameIdNum = parseInt(gameId);
        
        // Cargar biblioteca del usuario para verificar si ya tiene el juego
        gameIsInLibrary = false;
        if (isAuthenticated()) {
          try {
            const biblioteca = await apiGetBiblioteca();
            console.log('Biblioteca cargada:', biblioteca);
            if (biblioteca && Array.isArray(biblioteca)) {
              userBibliotecaIds = biblioteca.map(item => {
                const id = item.juego?.id || item.juego_id || item.id;
                return parseInt(id);
              }).filter(id => !isNaN(id));
              console.log('IDs en biblioteca:', userBibliotecaIds);
              console.log('ID del juego actual:', gameIdNum);
              gameIsInLibrary = userBibliotecaIds.includes(gameIdNum);
              console.log('¬øEst√° en biblioteca?:', gameIsInLibrary);
            }
          } catch (e) {
            console.log('No se pudo cargar biblioteca:', e);
          }
        }
        
        // Obtener datos completos del juego desde la API
        const game = await apiGetJuego(gameIdNum);
        
        if (!game || game.detail) {
          showToast('‚ùå No se pudo cargar el juego', 'error');
          closeGameDetailModal();
          return;
        }
        
        currentGameDetail = game;
        
        // Llenar el modal con los datos del juego
        renderGameDetailModal(game);
        
        // Cargar rese√±as
        loadGameReviews(gameIdNum);
        
      } catch (error) {
        console.error('Error cargando juego:', error);
        showToast('‚ùå Error al cargar los detalles', 'error');
        closeGameDetailModal();
      }
    }
    
    function renderGameDetailModal(game) {
      // Imagen de portada
      const heroContainer = document.getElementById('gameDetailHero');
      const heroText = document.getElementById('gameDetailHeroText');
      
      if (game.portada_url) {
        let imgUrl = game.portada_url;
        if (!imgUrl.startsWith('http')) {
          const backendUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:8000'
            : 'https://pyxolotl-production.up.railway.app';
          imgUrl = `${backendUrl}${imgUrl}`;
        }
        heroContainer.innerHTML = `<img src="${imgUrl}" class="game-detail-hero-img" alt="${game.titulo}" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\\'font-size:80px;font-weight:bold;color:#07102a\\'>${game.titulo.substring(0,2).toUpperCase()}</span>'">`;
      } else {
        heroContainer.innerHTML = `<span style="font-size:80px;font-weight:bold;color:#07102a">${game.titulo.substring(0,2).toUpperCase()}</span>`;
      }
      
      // T√≠tulo
      document.getElementById('gameDetailTitle').textContent = game.titulo;
      
      // G√©nero
      document.getElementById('gameDetailGenre').textContent = game.genero || 'Indie';
      
      // Rating
      const rating = game.calificacion_promedio || 0;
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      let stars = '‚òÖ'.repeat(fullStars);
      if (hasHalfStar && fullStars < 5) stars += '‚òÖ';
      stars += '‚òÜ'.repeat(5 - stars.length);
      document.getElementById('gameDetailStars').textContent = stars;
      document.getElementById('gameDetailReviews').textContent = game.total_resenas || 0;
      document.getElementById('gameDetailRating').textContent = rating.toFixed(1);
      
      // Precio
      const priceEl = document.getElementById('gameDetailPrice');
      if (game.precio === 0 || game.precio === null) {
        priceEl.textContent = '‚ú® GRATIS';
        priceEl.classList.add('free');
      } else {
        priceEl.textContent = `$${parseFloat(game.precio).toFixed(2)} MXN`;
        priceEl.classList.remove('free');
      }
      
      // Estad√≠sticas
      document.getElementById('gameDetailDownloads').textContent = game.total_descargas || 0;
      document.getElementById('gameDetailSales').textContent = game.total_ventas || 0;
      document.getElementById('gameDetailSize').textContent = game.tamano_mb ? `${game.tamano_mb.toFixed(1)} MB` : '--';
      
      // Desarrollador
      const devName = game.desarrollador?.nombre || 'Desarrollador Indie';
      document.getElementById('gameDetailDevName').textContent = devName;
      const devInitials = devName.split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase();
      document.getElementById('gameDetailDevAvatar').textContent = devInitials;
      
      // Screenshots
      renderScreenshots(game.screenshots_urls);
      
      // Descripci√≥n
      document.getElementById('gameDetailDesc').textContent = game.descripcion || 'Sin descripci√≥n disponible.';
      
      // Requisitos del Sistema
      renderRequirements(game.requisitos);
      
      // Bot√≥n de acci√≥n
      const actionBtn = document.getElementById('gameDetailActionBtn');
      
      // Si el juego ya est√° en la biblioteca, mostrar bot√≥n de descarga
      if (gameIsInLibrary) {
        actionBtn.textContent = 'üì• Descargar';
        actionBtn.className = 'btn game-detail-btn-download';
      } else if (game.precio === 0 || game.precio === null) {
        actionBtn.textContent = 'üéÆ Obtener gratis';
        actionBtn.className = 'btn game-detail-btn-download';
      } else {
        actionBtn.textContent = 'üõí Agregar al carrito';
        actionBtn.className = 'btn game-detail-btn-primary';
      }
    }
    
    function renderScreenshots(screenshotsUrls) {
      const container = document.getElementById('gameDetailScreenshots');
      const gallery = document.getElementById('screenshotsGallery');
      
      if (!screenshotsUrls || screenshotsUrls.length === 0) {
        container.style.display = 'none';
        return;
      }
      
      // Parsear si es string JSON
      let screenshots = screenshotsUrls;
      if (typeof screenshotsUrls === 'string') {
        try {
          screenshots = JSON.parse(screenshotsUrls);
        } catch (e) {
          container.style.display = 'none';
          return;
        }
      }
      
      if (!Array.isArray(screenshots) || screenshots.length === 0) {
        container.style.display = 'none';
        return;
      }
      
      // Construir URLs completas
      const backendUrl = window.location.hostname === 'localhost' 
        ? 'http://localhost:8000'
        : 'https://pyxolotl-production.up.railway.app';
      
      gallery.innerHTML = screenshots.map(url => {
        let imgUrl = url;
        if (!imgUrl.startsWith('http')) {
          imgUrl = `${backendUrl}${imgUrl}`;
        }
        return `
          <div class="screenshot-item" onclick="openScreenshotModal('${imgUrl}')">
            <img src="${imgUrl}" alt="Screenshot" onerror="this.parentElement.style.display='none'">
          </div>
        `;
      }).join('');
      
      container.style.display = 'block';
    }
    
    function openScreenshotModal(imgUrl) {
      const modal = document.getElementById('screenshotModal');
      const img = document.getElementById('screenshotModalImg');
      img.src = imgUrl;
      modal.classList.add('active');
    }
    
    function closeScreenshotModal() {
      document.getElementById('screenshotModal').classList.remove('active');
    }
    
    function renderRequirements(requisitos) {
      const reqSection = document.getElementById('gameDetailRequirements');
      const reqMin = document.getElementById('gameDetailReqMin');
      const reqRec = document.getElementById('gameDetailReqRec');
      
      if (!requisitos || requisitos.trim() === '') {
        reqSection.style.display = 'none';
        return;
      }
      
      // Intentar parsear como JSON
      try {
        const reqData = JSON.parse(requisitos);
        
        // Verificar si hay datos v√°lidos
        const hasMinimos = reqData.minimos && Object.values(reqData.minimos).some(v => v && v.trim() !== '');
        const hasRecomendados = reqData.recomendados && Object.values(reqData.recomendados).some(v => v && v.trim() !== '');
        
        if (!hasMinimos && !hasRecomendados) {
          reqSection.style.display = 'none';
          return;
        }
        
        reqSection.style.display = 'block';
        
        // Renderizar m√≠nimos (con 's' como viene de la BD)
        if (hasMinimos) {
          reqMin.innerHTML = renderRequirementsList(reqData.minimos);
        } else {
          reqMin.innerHTML = '<p style="color:var(--muted)">No especificado</p>';
        }
        
        // Renderizar recomendados (con 's' como viene de la BD)
        if (hasRecomendados) {
          reqRec.innerHTML = renderRequirementsList(reqData.recomendados);
        } else {
          reqRec.innerHTML = '<p style="color:var(--muted)">No especificado</p>';
        }
        
        // Mostrar plataformas si existen
        if (reqData.plataformas && reqData.plataformas.length > 0) {
          const platformsHtml = `
            <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(123,97,255,0.2)">
              <span class="requirement-label">PLATAFORMAS</span>
              <span class="requirement-value">${reqData.plataformas.join(', ')}</span>
            </div>
          `;
          reqMin.innerHTML += platformsHtml;
        }
        
      } catch (e) {
        console.error('Error parseando requisitos:', e);
        reqSection.style.display = 'none';
      }
    }
    
    function renderRequirementsList(reqs) {
      // Labels que coinciden con los campos de la BD
      const labels = {
        os: 'SO',
        cpu: 'PROCESADOR',
        ram: 'MEMORIA',
        gpu: 'GR√ÅFICOS',
        storage: 'ALMACENAMIENTO',
        // Campos alternativos por si acaso
        so: 'SO',
        procesador: 'PROCESADOR',
        memoria: 'MEMORIA',
        graficos: 'GR√ÅFICOS',
        almacenamiento: 'ALMACENAMIENTO',
        directx: 'DIRECTX',
        red: 'RED',
        notas: 'NOTAS'
      };
      
      let html = '';
      for (const [key, value] of Object.entries(reqs)) {
        if (value && value.trim() !== '') {
          const label = labels[key] || key.toUpperCase();
          html += `
            <div class="requirement-item">
              <span class="requirement-label">${label}</span>
              <span class="requirement-value">${value}</span>
            </div>
          `;
        }
      }
      return html || '<p style="color:var(--muted)">No especificado</p>';
    }
    
    async function loadGameReviews(gameId) {
      const reviewsList = document.getElementById('gameDetailReviewsList');
      reviewsList.innerHTML = '<div class="reviews-loading">Cargando rese√±as...</div>';
      
      // Configurar formulario de rese√±as
      setupReviewForm();
      
      try {
        const reviews = await apiGetResenas(gameId);
        
        if (!reviews || reviews.length === 0 || reviews.detail) {
          reviewsList.innerHTML = `
            <div class="reviews-empty">
              <div style="font-size:48px;margin-bottom:12px">üí¨</div>
              <p>A√∫n no hay rese√±as para este juego</p>
              <p style="font-size:13px;margin-top:8px">¬°S√© el primero en dejar una rese√±a!</p>
            </div>
          `;
          return;
        }
        
        // Ordenar por fecha m√°s reciente
        const sortedReviews = reviews.sort((a, b) => 
          new Date(b.fecha_creacion) - new Date(a.fecha_creacion)
        );
        
        reviewsList.innerHTML = sortedReviews.map(review => renderReviewCard(review)).join('');
        
      } catch (error) {
        console.error('Error cargando rese√±as:', error);
        reviewsList.innerHTML = `
          <div class="reviews-empty">
            <p>Error al cargar las rese√±as</p>
          </div>
        `;
      }
    }
    
    function renderReviewCard(review) {
      const userName = review.usuario?.nombre || 'Usuario';
      const userInitials = userName.split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase();
      
      // Determinar si es positiva, negativa o neutral
      const rating = review.calificacion || 0;
      let badgeClass = 'neutral';
      let badgeIcon = 'üòê';
      let badgeText = 'Neutral';
      
      if (rating >= 4) {
        badgeClass = 'positive';
        badgeIcon = 'üëç';
        badgeText = 'Recomendado';
      } else if (rating <= 2) {
        badgeClass = 'negative';
        badgeIcon = 'üëé';
        badgeText = 'No recomendado';
      }
      
      // Formatear fecha
      const fecha = new Date(review.fecha_creacion);
      const fechaStr = fecha.toLocaleDateString('es-MX', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
      
      // Generar estrellas
      const stars = '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
      
      return `
        <div class="review-card">
          <div class="review-header">
            <div class="review-avatar">${userInitials}</div>
            <div class="review-user-info">
              <div class="review-user-name">${userName}</div>
              <div class="review-date">Publicada el ${fechaStr}</div>
            </div>
            <div class="review-rating-badge ${badgeClass}">
              ${badgeIcon} ${badgeText}
            </div>
          </div>
          <div class="review-stars">${stars}</div>
          <div class="review-content">${review.texto || 'Sin comentario'}</div>
        </div>
      `;
    }
    
    // ========== FORMULARIO DE RESE√ëAS ==========
    let selectedReviewRating = 0;
    
    function setupReviewForm() {
      // Verificar si el usuario est√° autenticado
      const reviewForm = document.getElementById('gameDetailReviewForm');
      const loginPrompt = document.getElementById('gameDetailReviewLoginPrompt');
      
      if (isAuthenticated()) {
        reviewForm.style.display = 'block';
        loginPrompt.style.display = 'none';
        
        // Configurar estrellas
        setupStarRating();
        
        // Configurar contador de caracteres
        setupCharCounter();
      } else {
        reviewForm.style.display = 'none';
        loginPrompt.style.display = 'block';
      }
      
      // Resetear formulario
      selectedReviewRating = 0;
      updateStarDisplay(0);
      document.getElementById('gameDetailReviewText').value = '';
      document.getElementById('gameDetailCharCount').textContent = '0/1000';
    }
    
    function setupStarRating() {
      const starContainer = document.getElementById('gameDetailStarRating');
      const stars = starContainer.querySelectorAll('.star');
      
      stars.forEach(star => {
        // Hover effect
        star.addEventListener('mouseenter', () => {
          const rating = parseInt(star.dataset.rating);
          highlightStars(rating);
        });
        
        // Click to select
        star.addEventListener('click', () => {
          selectedReviewRating = parseInt(star.dataset.rating);
          updateStarDisplay(selectedReviewRating);
          updateRatingText(selectedReviewRating);
        });
      });
      
      // Mouse leave container - restore selected
      starContainer.addEventListener('mouseleave', () => {
        updateStarDisplay(selectedReviewRating);
      });
    }
    
    function highlightStars(rating) {
      const stars = document.querySelectorAll('#gameDetailStarRating .star');
      stars.forEach(star => {
        const starRating = parseInt(star.dataset.rating);
        star.classList.toggle('hovered', starRating <= rating);
        star.textContent = starRating <= rating ? '‚òÖ' : '‚òÜ';
      });
    }
    
    function updateStarDisplay(rating) {
      const stars = document.querySelectorAll('#gameDetailStarRating .star');
      stars.forEach(star => {
        const starRating = parseInt(star.dataset.rating);
        star.classList.remove('hovered');
        star.classList.toggle('active', starRating <= rating);
        star.textContent = starRating <= rating ? '‚òÖ' : '‚òÜ';
      });
    }
    
    function updateRatingText(rating) {
      const ratingText = document.getElementById('gameDetailRatingText');
      const texts = {
        0: 'Selecciona una calificaci√≥n',
        1: 'üòû Muy malo',
        2: 'üòï Malo',
        3: 'üòê Regular',
        4: 'üòä Bueno',
        5: 'üòç ¬°Excelente!'
      };
      ratingText.textContent = texts[rating] || '';
    }
    
    function setupCharCounter() {
      const textarea = document.getElementById('gameDetailReviewText');
      const counter = document.getElementById('gameDetailCharCount');
      
      textarea.addEventListener('input', () => {
        const length = textarea.value.length;
        counter.textContent = `${length}/1000`;
        counter.style.color = length > 900 ? '#ff4757' : 'var(--muted)';
      });
    }
    
    async function submitGameReview() {
      if (!currentGameDetail) return;
      
      // Validaciones
      if (selectedReviewRating === 0) {
        showToast('‚≠ê Por favor selecciona una calificaci√≥n', 'error');
        return;
      }
      
      const texto = document.getElementById('gameDetailReviewText').value.trim();
      if (texto.length < 10) {
        showToast('‚úçÔ∏è Tu rese√±a debe tener al menos 10 caracteres', 'error');
        return;
      }
      
      try {
        const result = await apiCrearResena(currentGameDetail.id, selectedReviewRating, texto);
        
        if (result.id) {
          showToast('‚úÖ ¬°Rese√±a publicada exitosamente!', 'success');
          
          // Resetear formulario
          selectedReviewRating = 0;
          updateStarDisplay(0);
          updateRatingText(0);
          document.getElementById('gameDetailReviewText').value = '';
          document.getElementById('gameDetailCharCount').textContent = '0/1000';
          
          // Recargar rese√±as
          loadGameReviews(currentGameDetail.id);
          
          // Actualizar contador de rese√±as en el modal
          const reviewCount = document.getElementById('gameDetailReviews');
          reviewCount.textContent = parseInt(reviewCount.textContent) + 1;
          
        } else {
          showToast('‚ùå ' + (result.detail || 'Error al publicar rese√±a'), 'error');
        }
      } catch (error) {
        console.error('Error al publicar rese√±a:', error);
        showToast('‚ùå Error al publicar la rese√±a', 'error');
      }
    }
    
    function closeGameDetailModal() {
      const modal = document.getElementById('gameDetailModal');
      modal.classList.remove('active');
      document.body.classList.remove('modal-open');
      currentGameDetail = null;
      selectedReviewRating = 0;
    }
    
    // Cerrar modal al hacer click fuera del contenido
    document.getElementById('gameDetailModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeGameDetailModal();
      }
    });
    
    async function handleGameDetailAction() {
      if (!currentGameDetail) return;
      
      const game = currentGameDetail;
      
      // Si el juego est√° en la biblioteca, descargar directamente
      if (gameIsInLibrary) {
        showToast('üì• Iniciando descarga...', 'info');
        downloadGameFile(game);
        return;
      }
      
      if (game.precio === 0 || game.precio === null) {
        // Juego gratis - obtener y descargar
        await handleFreeGameFromModal(game);
      } else {
        // Juego de pago - agregar al carrito
        handleAddToCartFromModal(game);
      }
    }
    
    async function handleFreeGameFromModal(game) {
      if (!isAuthenticated()) {
        showToast('Debes iniciar sesi√≥n para obtener juegos gratis', 'error');
        setTimeout(() => {
          window.location.href = 'inicio.html';
        }, 1500);
        return;
      }
      
      try {
        const response = await apiGetJuegoGratis(game.id);
        
        if (response.success || response.id) {
          showToast('‚úÖ ¬°Juego agregado a tu biblioteca! Iniciando descarga...', 'success');
          
          // Descargar directamente
          setTimeout(() => {
            downloadGameFile(game);
          }, 1000);
          
          closeGameDetailModal();
        } else if (response.detail && response.detail.includes('ya')) {
          // Ya lo tiene en biblioteca
          showToast('üì• Ya tienes este juego. Iniciando descarga...', 'info');
          downloadGameFile(game);
          closeGameDetailModal();
        } else {
          showToast('‚ùå ' + (response.detail || response.message || 'Error'), 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        // Si ya lo tiene, descargar igual
        if (error.message && error.message.includes('ya')) {
          showToast('üì• Iniciando descarga...', 'info');
          downloadGameFile(game);
          closeGameDetailModal();
        } else {
          showToast('‚ùå Error al obtener el juego', 'error');
        }
      }
    }
    
    function handleAddToCartFromModal(game) {
      if (typeof window.addToCart === 'function') {
        // Construir URL de portada
        let portadaUrl = game.portada_url || null;
        if (portadaUrl && !portadaUrl.startsWith('http')) {
          const backendUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:8000'
            : 'https://pyxolotl-production.up.railway.app';
          portadaUrl = `${backendUrl}${portadaUrl}`;
        }
        
        window.addToCart(game.id, game.titulo, game.precio, portadaUrl, game.archivo_juego_url);
        closeGameDetailModal();
      } else {
        showToast('‚ùå Error al agregar al carrito', 'error');
      }
    }
    
    function downloadGameFile(game) {
      if (!game.archivo_juego_url) {
        showToast('‚ùå URL de descarga no disponible', 'error');
        return;
      }
      
      let downloadUrl = game.archivo_juego_url;
      
      if (!downloadUrl.startsWith('http')) {
        const backendUrl = window.location.hostname === 'localhost' 
          ? 'http://localhost:8000'
          : 'https://pyxolotl-production.up.railway.app';
        downloadUrl = `${backendUrl}${downloadUrl}`;
      }
      
      const link = document.createElement('a');
      link.href = downloadUrl;
      link.download = `${game.titulo.replace(/[^a-z0-9]/gi, '_')}.zip`;
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('‚úÖ Descarga iniciada', 'success');
    }

    // ============================================
    // SISTEMA DE PERFIL CON LOCALSTORAGE
    // ============================================
    
    function getProfileData() {
      const saved = localStorage.getItem('user_profile');
      if (saved) {
        return JSON.parse(saved);
      }
      return {
        avatarBase64: null, // Imagen guardada como base64
        displayName: null,
        bio: null
      };
    }

    function saveProfileData(data) {
      localStorage.setItem('user_profile', JSON.stringify(data));
      updateUserInterface();
    }

    function updateUserInterface() {
      const user = getCurrentUser();
      const profile = getProfileData();
      
      if (!user) return;

      // Actualizar nombre (prioridad: displayName > nombre del usuario)
      const displayName = profile.displayName || user.nombre;
      document.getElementById('userName').textContent = displayName;
      document.getElementById('profileNameInput').value = profile.displayName || user.nombre;

      // Actualizar avatar peque√±o
      const userAvatar = document.getElementById('userAvatar');
      const userInitials = document.getElementById('userInitials');
      
      if (profile.avatarBase64) {
        userAvatar.innerHTML = `<img src="${profile.avatarBase64}" alt="Avatar">`;
      } else {
        const initials = displayName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        userInitials.textContent = initials;
      }

      // Actualizar avatar grande en modal
      const profileAvatarLarge = document.getElementById('profileAvatarLarge');
      const profileInitialsLarge = document.getElementById('profileInitialsLarge');
      const removeAvatarBtn = document.getElementById('removeAvatarBtn');
      
      if (profile.avatarBase64) {
        profileAvatarLarge.innerHTML = `<img src="${profile.avatarBase64}" alt="Avatar">`;
        removeAvatarBtn.style.display = 'inline-block'; // Mostrar bot√≥n de eliminar
      } else {
        const initials = displayName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        profileInitialsLarge.textContent = initials;
        removeAvatarBtn.style.display = 'none'; // Ocultar bot√≥n de eliminar
      }

      // Actualizar otros campos
      document.getElementById('profileEmailInput').value = user.email;
      document.getElementById('profileTypeInput').value = 
        user.tipo_cuenta === 'desarrollador' ? 'Desarrollador' : 'Comprador';
      document.getElementById('profileBioInput').value = profile.bio || '';
    }

    function openProfileModal() {
      document.getElementById('profileModal').classList.add('show');
      updateUserInterface();
    }

    function closeProfileModal() {
      document.getElementById('profileModal').classList.remove('show');
    }

    // Event listeners para cerrar modales
    document.querySelectorAll('.close-profile').forEach(btn => {
      btn.addEventListener('click', closeProfileModal);
    });

    // Cerrar modal al hacer click fuera
    document.getElementById('profileModal').addEventListener('click', (e) => {
      if (e.target.id === 'profileModal') {
        closeProfileModal();
      }
    });

    // ============================================
    // SUBIR IMAGEN LOCAL (BASE64)
    // ============================================
    
    document.getElementById('avatarUpload').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      // Validar tipo de archivo
      if (!file.type.startsWith('image/')) {
        showToast('‚ùå Por favor selecciona una imagen v√°lida', 'error');
        return;
      }

      // Validar tama√±o (m√°x 2MB para localStorage)
      if (file.size > 2 * 1024 * 1024) {
        showToast('‚ùå La imagen es demasiado grande. M√°ximo 2MB', 'error');
        return;
      }

      const uploadProgress = document.getElementById('uploadProgress');
      uploadProgress.style.display = 'block';
      uploadProgress.textContent = 'Procesando imagen...';

      // Leer archivo como base64
      const reader = new FileReader();
      
      reader.onload = function(event) {
        const base64Image = event.target.result;
        
        // Guardar en perfil
        const profile = getProfileData();
        profile.avatarBase64 = base64Image;
        saveProfileData(profile);

        // ‚úÖ ACTUALIZACI√ìN INMEDIATA: Mostrar imagen en el modal
        const profileAvatarLarge = document.getElementById('profileAvatarLarge');
        if (profileAvatarLarge) {
          // Buscar o crear el img dentro del avatar large
          let imgElement = profileAvatarLarge.querySelector('img');
          if (!imgElement) {
            imgElement = document.createElement('img');
            imgElement.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:50%';
            profileAvatarLarge.insertBefore(imgElement, profileAvatarLarge.firstChild);
          }
          imgElement.src = base64Image;
          
          // Ocultar iniciales si existen
          const initialsSpan = profileAvatarLarge.querySelector('span:not(.avatar-overlay span)');
          if (initialsSpan) initialsSpan.style.display = 'none';
        }
        
        // ‚úÖ ACTUALIZACI√ìN INMEDIATA: Mostrar imagen en el header
        const userAvatar = document.getElementById('userAvatar');
        if (userAvatar) {
          userAvatar.innerHTML = `<img src="${base64Image}" alt="Avatar" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
        }

        uploadProgress.style.display = 'none';
        showToast('‚úÖ Foto de perfil actualizada', 'success');
      };

      reader.onerror = function() {
        uploadProgress.style.display = 'none';
        showToast('‚ùå Error al procesar la imagen', 'error');
      };

      reader.readAsDataURL(file);
    });

    // ============================================
    // ELIMINAR FOTO DE PERFIL
    // ============================================
    
    document.getElementById('removeAvatarBtn').addEventListener('click', () => {
      if (confirm('¬øEst√°s seguro de que quieres eliminar tu foto de perfil?')) {
        const profile = getProfileData();
        profile.avatarBase64 = null;
        saveProfileData(profile);
        alert('‚úÖ Foto de perfil eliminada');
      }
    });

    // ============================================
    // CAMBIAR CONTRASE√ëA
    // ============================================
    
    // Mostrar/ocultar formulario de cambio de contrase√±a
    document.getElementById('showPasswordChangeBtn').addEventListener('click', () => {
      const form = document.getElementById('passwordChangeForm');
      const btn = document.getElementById('showPasswordChangeBtn');
      
      if (form.style.display === 'none') {
        form.style.display = 'block';
        btn.style.display = 'none';
      }
    });

    document.getElementById('cancelPasswordBtn').addEventListener('click', () => {
      const form = document.getElementById('passwordChangeForm');
      const btn = document.getElementById('showPasswordChangeBtn');
      
      form.style.display = 'none';
      btn.style.display = 'block';
      
      // Limpiar campos
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
    });

    document.getElementById('changePasswordBtn').addEventListener('click', async () => {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      // Validaciones
      if (!currentPassword || !newPassword || !confirmPassword) {
        alert('‚ùå Por favor completa todos los campos');
        return;
      }

      if (newPassword.length < 8) {
        alert('‚ùå La nueva contrase√±a debe tener al menos 8 caracteres');
        return;
      }

      if (newPassword !== confirmPassword) {
        alert('‚ùå Las contrase√±as no coinciden');
        return;
      }

      const btn = document.getElementById('changePasswordBtn');
      const originalText = btn.textContent;
      btn.textContent = 'Cambiando...';
      btn.disabled = true;

      try {
        // Llamar a la API para cambiar la contrase√±a
        const response = await apiCambiarPassword(currentPassword, newPassword);
        
        if (response.success) {
          alert('‚úÖ Contrase√±a cambiada correctamente');
          
          // Limpiar y ocultar formulario
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
          document.getElementById('passwordChangeForm').style.display = 'none';
          document.getElementById('showPasswordChangeBtn').style.display = 'block';
        } else {
          alert('‚ùå ' + (response.message || 'Error al cambiar la contrase√±a'));
        }
        
      } catch (error) {
        console.error('Error cambiando contrase√±a:', error);
        alert('‚ùå Error al cambiar la contrase√±a. Por favor intenta de nuevo.');
      } finally {
        btn.textContent = originalText;
        btn.disabled = false;
      }
    });

    // ============================================
    // GUARDAR CAMBIOS DEL PERFIL
    // ============================================
    
    document.getElementById('saveProfileBtn').addEventListener('click', () => {
      const profile = getProfileData();
      const newName = document.getElementById('profileNameInput').value.trim();
      const newBio = document.getElementById('profileBioInput').value.trim();

      if (!newName) {
        alert('‚ùå El nombre no puede estar vac√≠o');
        return;
      }

      profile.displayName = newName;
      profile.bio = newBio;
      
      saveProfileData(profile);
      closeProfileModal();
      
      alert('‚úÖ Perfil actualizado correctamente');
    });

    // ============================================
    // VARIABLES GLOBALES PARA JUEGOS
    // ============================================
    let allGamesData = [];
    let filteredGames = [];
    let displayedGamesCount = 0;
    const GAMES_PER_PAGE = 30;
    let featuredGameId = null;

    // ============================================
    // CARGAR JUEGOS DESDE LA BASE DE DATOS
    // ============================================
    
    async function loadGames() {
      const loader = document.getElementById('gamesLoader');
      const noGamesMsg = document.getElementById('noGamesMessage');

      try {
        const response = await apiGetJuegos({ estado: 'aprobado' });
        
        console.log('Juegos cargados:', response?.length || 0);
        
        loader.style.display = 'none';

        if (!response || response.length === 0) {
          noGamesMsg.style.display = 'block';
          return;
        }

        noGamesMsg.style.display = 'none';
        
        // Guardar todos los juegos
        allGamesData = response;
        filteredGames = [...allGamesData];
        
        // Ordenar por fecha m√°s reciente
        allGamesData.sort((a, b) => new Date(b.fecha_creacion || 0) - new Date(a.fecha_creacion || 0));
        
        // Cargar destacado
        loadFeaturedGame();
        
        // Cargar g√©neros en filtro
        loadGenreFilter();
        
        // Cargar categor√≠as por g√©nero
        loadCategorySections();
        
        // Cargar lista de juegos
        displayedGamesCount = 0;
        loadMoreGames();
        
        // Configurar b√∫squeda y filtros
        setupSearchAndFilters();

      } catch (error) {
        console.error('Error al cargar juegos:', error);
        loader.style.display = 'none';
        noGamesMsg.style.display = 'block';
        noGamesMsg.innerHTML = `
          <div style="font-size:48px;margin-bottom:16px">‚ö†Ô∏è</div>
          <h3>Error al cargar juegos</h3>
          <p>No se pudo conectar con el servidor. Por favor intenta m√°s tarde.</p>
        `;
      }
    }

    // ============================================
    // JUEGO DESTACADO (mejor valorado)
    // ============================================
    function loadFeaturedGame() {
      // Ordenar por calificaci√≥n (desc) y luego por fecha (desc)
      const sorted = [...allGamesData].sort((a, b) => {
        const ratingA = parseFloat(a.calificacion_promedio) || 0;
        const ratingB = parseFloat(b.calificacion_promedio) || 0;
        if (ratingB !== ratingA) return ratingB - ratingA;
        return new Date(b.fecha_creacion || 0) - new Date(a.fecha_creacion || 0);
      });
      
      const featured = sorted[0];
      if (!featured) return;
      
      featuredGameId = featured.id;
      
      const imgEl = document.getElementById('featuredImage');
      if (featured.portada_url) {
        const url = getImageUrl(featured.portada_url);
        imgEl.style.backgroundImage = `url('${url}')`;
        imgEl.textContent = '';
      } else {
        imgEl.textContent = featured.titulo.substring(0, 2).toUpperCase();
      }
      
      document.getElementById('featuredTitle').textContent = featured.titulo;
      document.getElementById('featuredDesc').textContent = featured.descripcion ? 
        (featured.descripcion.length > 120 ? featured.descripcion.substring(0, 120) + '...' : featured.descripcion) : 
        `${featured.genero} ¬∑ Por ${featured.desarrollador_nombre || 'Indie Developer'}`;
      
      const rating = parseFloat(featured.calificacion_promedio) || 0;
      document.getElementById('featuredRating').textContent = `‚òÖ ${rating.toFixed(1)}`;
      
      const price = parseFloat(featured.precio) || 0;
      document.getElementById('featuredPrice').textContent = price === 0 ? '‚ú® GRATIS' : `$${price.toFixed(2)} MXN`;
    }
    
    function openFeaturedGame() {
      if (featuredGameId) openGameDetailModal(featuredGameId);
    }

    // ============================================
    // FILTRO DE G√âNEROS
    // ============================================
    function loadGenreFilter() {
      const genreSelect = document.getElementById('filterGenre');
      const genres = {};
      
      allGamesData.forEach(g => {
        const genre = g.genero || 'Otros';
        genres[genre] = (genres[genre] || 0) + 1;
      });
      
      // Ordenar por cantidad
      const sortedGenres = Object.entries(genres).sort((a, b) => b[1] - a[1]);
      
      sortedGenres.forEach(([genre, count]) => {
        const opt = document.createElement('option');
        opt.value = genre;
        opt.textContent = `${genre} (${count})`;
        genreSelect.appendChild(opt);
      });
    }

    // ============================================
    // SECCIONES POR CATEGOR√çA (scroll horizontal)
    // ============================================
    function loadCategorySections() {
      const container = document.getElementById('categorySections');
      container.innerHTML = '';
      
      // Contar juegos por g√©nero
      const genreCounts = {};
      allGamesData.forEach(g => {
        const genre = g.genero || 'Otros';
        genreCounts[genre] = (genreCounts[genre] || 0) + 1;
      });
      
      // Top 5 g√©neros con m√°s juegos
      const topGenres = Object.entries(genreCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5)
        .map(([genre]) => genre);
      
      const genreIcons = {
        'accion': '‚öîÔ∏è', 'action': '‚öîÔ∏è', 'acci√≥n': '‚öîÔ∏è',
        'aventura': 'üó∫Ô∏è', 'adventure': 'üó∫Ô∏è',
        'rpg': 'üßô', 'rol': 'üßô',
        'puzzle': 'üß©', 'rompecabezas': 'üß©',
        'terror': 'üëª', 'horror': 'üëª',
        'plataformas': 'üèÉ', 'platformer': 'üèÉ',
        'estrategia': '‚ôüÔ∏è', 'strategy': '‚ôüÔ∏è',
        'deportes': '‚öΩ', 'sports': '‚öΩ',
        'simulacion': 'üéÆ', 'simulation': 'üéÆ',
        'carreras': 'üèéÔ∏è', 'racing': 'üèéÔ∏è',
        'peleas': 'ü•ä', 'fighting': 'ü•ä',
        'shooter': 'üéØ', 'disparos': 'üéØ'
      };
      
      topGenres.forEach(genre => {
        const gamesInGenre = allGamesData
          .filter(g => (g.genero || 'Otros') === genre)
          .sort((a, b) => new Date(b.fecha_creacion || 0) - new Date(a.fecha_creacion || 0))
          .slice(0, 10);
        
        if (gamesInGenre.length === 0) return;
        
        const icon = genreIcons[genre.toLowerCase()] || 'üéÆ';
        const sectionId = `category-${genre.replace(/\s/g, '-')}`;
        const genreCapitalized = genre.charAt(0).toUpperCase() + genre.slice(1).toLowerCase();
        
        const section = document.createElement('div');
        section.className = 'category-section';
        section.innerHTML = `
          <div class="category-header">
            <h3 class="category-title">${icon} <span>${genreCapitalized}</span></h3>
            <span class="category-count">${gamesInGenre.length} juegos</span>
          </div>
          <div class="category-scroll-wrapper">
            <button class="scroll-btn scroll-btn-left" onclick="scrollCategory('${sectionId}', -1)">‚Äπ</button>
            <div id="${sectionId}" class="category-scroll">
              ${gamesInGenre.map(g => createScrollCard(g)).join('')}
            </div>
            <button class="scroll-btn scroll-btn-right" onclick="scrollCategory('${sectionId}', 1)">‚Ä∫</button>
          </div>
        `;
        container.appendChild(section);
      });
    }
    
    function createScrollCard(game) {
      const imgUrl = game.portada_url ? getImageUrl(game.portada_url) : null;
      const initials = game.titulo.substring(0, 2).toUpperCase();
      const price = parseFloat(game.precio || 0);
      const priceText = price === 0 ? '<span class="free">‚ú® Gratis</span>' : `$${price.toFixed(2)}`;
      
      return `
        <div class="scroll-card" onclick="openGameDetailModal(${game.id})">
          <div class="scroll-card-img">
            ${imgUrl ? `<img src="${imgUrl}" onerror="this.parentElement.textContent='${initials}'">` : initials}
          </div>
          <div class="scroll-card-info">
            <div class="scroll-card-title">${game.titulo}</div>
            <div class="scroll-card-price">${priceText}</div>
          </div>
        </div>
      `;
    }
    
    function scrollCategory(sectionId, direction) {
      const container = document.getElementById(sectionId);
      const scrollAmount = 220 * direction;
      container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
    }

    // ============================================
    // LISTA DE JUEGOS (estilo Steam)
    // ============================================
    function loadMoreGames() {
      const listContainer = document.getElementById('gamesList');
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      
      const gamesToShow = filteredGames.slice(displayedGamesCount, displayedGamesCount + GAMES_PER_PAGE);
      
      gamesToShow.forEach(game => {
        listContainer.appendChild(createGameListItem(game));
      });
      
      displayedGamesCount += gamesToShow.length;
      
      document.getElementById('totalGamesCount').textContent = `Mostrando ${displayedGamesCount} de ${filteredGames.length} juegos`;
      
      loadMoreBtn.style.display = displayedGamesCount < filteredGames.length ? 'block' : 'none';
    }
    
    function createGameListItem(game) {
      const item = document.createElement('div');
      item.className = 'game-list-item';
      item.onclick = () => openGameDetailModal(game.id);
      
      const imgUrl = game.portada_url ? getImageUrl(game.portada_url) : null;
      const initials = game.titulo.substring(0, 2).toUpperCase();
      const price = parseFloat(game.precio) || 0;
      const rating = parseFloat(game.calificacion_promedio) || 0;
      const reviews = parseInt(game.total_resenas) || 0;
      const fecha = game.fecha_creacion ? new Date(game.fecha_creacion).toLocaleDateString('es-MX', { day: 'numeric', month: 'short', year: 'numeric' }) : '';
      const starsCount = Math.min(5, Math.max(0, Math.round(rating)));
      
      item.innerHTML = `
        <div class="game-list-img">
          ${imgUrl ? `<img src="${imgUrl}" onerror="this.parentElement.textContent='${initials}'">` : initials}
        </div>
        <div class="game-list-info">
          <div class="game-list-title-text">${game.titulo}</div>
          <div class="game-list-tags">
            <span class="game-list-tag">${game.genero || 'Indie'}</span>
            ${game.desarrollador_nombre ? `<span class="game-list-tag">${game.desarrollador_nombre}</span>` : ''}
          </div>
        </div>
        <div class="game-list-rating">
          <div class="game-list-stars">${'‚òÖ'.repeat(starsCount)}${'‚òÜ'.repeat(5 - starsCount)}</div>
          <div class="game-list-reviews">(${reviews} rese√±as)</div>
        </div>
        <div class="game-list-price">
          ${price === 0 ? '<div class="game-list-price-free">‚ú® Gratis</div>' : `<div class="game-list-price-value">$${price.toFixed(2)}</div>`}
        </div>
        <div class="game-list-date">${fecha}</div>
      `;
      
      return item;
    }

    // ============================================
    // B√öSQUEDA Y FILTROS
    // ============================================
    function setupSearchAndFilters() {
      const searchInput = document.getElementById('searchInput');
      const searchDropdown = document.getElementById('searchDropdown');
      const filterPrice = document.getElementById('filterPrice');
      const filterRating = document.getElementById('filterRating');
      const filterGenre = document.getElementById('filterGenre');
      
      // B√∫squeda en tiempo real
      let searchTimeout;
      searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim().toLowerCase();
        
        if (query.length < 2) {
          searchDropdown.classList.remove('active');
          return;
        }
        
        searchTimeout = setTimeout(() => {
          const results = allGamesData.filter(g => 
            g.titulo.toLowerCase().includes(query) || 
            (g.genero && g.genero.toLowerCase().includes(query)) ||
            (g.desarrollador_nombre && g.desarrollador_nombre.toLowerCase().includes(query))
          ).slice(0, 10);
          
          renderSearchResults(results, query);
        }, 200);
      });
      
      // Cerrar dropdown al hacer clic fuera
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-input-wrapper')) {
          searchDropdown.classList.remove('active');
        }
      });
      
      // Filtros
      [filterPrice, filterRating, filterGenre].forEach(filter => {
        filter.addEventListener('change', applyFilters);
      });
    }
    
    function renderSearchResults(results, query) {
      const dropdown = document.getElementById('searchDropdown');
      
      if (results.length === 0) {
        dropdown.innerHTML = '<div class="search-no-results">No se encontraron juegos para "<strong>' + query + '</strong>"</div>';
        dropdown.classList.add('active');
        return;
      }
      
      dropdown.innerHTML = results.map(game => {
        const imgUrl = game.portada_url ? getImageUrl(game.portada_url) : null;
        const initials = game.titulo.substring(0, 2).toUpperCase();
        const price = parseFloat(game.precio || 0);
        const fecha = game.fecha_creacion ? new Date(game.fecha_creacion).toLocaleDateString('es-MX', { day: 'numeric', month: 'short', year: 'numeric' }) : '';
        
        return `
          <div class="search-result-item" onclick="openGameDetailModal(${game.id}); document.getElementById('searchDropdown').classList.remove('active');">
            <div class="search-result-img">
              ${imgUrl ? `<img src="${imgUrl}" onerror="this.parentElement.textContent='${initials}'">` : initials}
            </div>
            <div class="search-result-info">
              <div class="search-result-title">${highlightMatch(game.titulo, query)}</div>
              <div class="search-result-tags">
                <span class="search-result-tag">${game.genero || 'Indie'}</span>
                ${game.desarrollador_nombre ? `<span class="search-result-tag">${game.desarrollador_nombre}</span>` : ''}
              </div>
            </div>
            <div class="search-result-price">
              ${price === 0 ? '<div class="search-result-price-value" style="color:#4CAF50">‚ú® Gratis</div>' : `<div class="search-result-price-value">$${price.toFixed(2)}</div>`}
              <div class="search-result-date">${fecha}</div>
            </div>
          </div>
        `;
      }).join('');
      
      dropdown.classList.add('active');
    }
    
    function highlightMatch(text, query) {
      const regex = new RegExp(`(${query})`, 'gi');
      return text.replace(regex, '<mark style="background:var(--accent-1);color:#07102a;padding:0 2px;border-radius:2px">$1</mark>');
    }
    
    function applyFilters() {
      const priceFilter = document.getElementById('filterPrice').value;
      const ratingFilter = document.getElementById('filterRating').value;
      const genreFilter = document.getElementById('filterGenre').value;
      
      // Detectar si hay alg√∫n filtro activo
      const hasActiveFilters = priceFilter || ratingFilter || genreFilter;
      
      // Ocultar/mostrar categor√≠as seg√∫n filtros
      const categorySections = document.getElementById('categorySections');
      categorySections.style.display = hasActiveFilters ? 'none' : 'block';
      
      // Debug: mostrar qu√© filtros est√°n activos
      console.log('Filtros activos:', { priceFilter, ratingFilter, genreFilter });
      
      filteredGames = allGamesData.filter(game => {
        const price = parseFloat(game.precio) || 0;
        // Usar parseFloat para asegurar comparaci√≥n num√©rica correcta
        const rating = parseFloat(game.calificacion_promedio) || 0;
        const genre = game.genero || '';
        
        // Filtro precio
        if (priceFilter) {
          if (priceFilter === 'free' && price > 0) return false;
          if (priceFilter === '0-50' && (price < 0 || price > 50)) return false;
          if (priceFilter === '50-100' && (price < 50 || price > 100)) return false;
          if (priceFilter === '100-200' && (price < 100 || price > 200)) return false;
          if (priceFilter === '200+' && price < 200) return false;
        }
        
        // Filtro valoraci√≥n - comparar con >= para incluir juegos con exactamente esa calificaci√≥n
        if (ratingFilter) {
          const minRating = parseFloat(ratingFilter);
          if (rating < minRating) {
            console.log(`Juego "${game.titulo}" excluido: rating ${rating} < ${minRating}`);
            return false;
          }
        }
        
        // Filtro g√©nero
        if (genreFilter && genre !== genreFilter) return false;
        
        return true;
      });
      
      console.log(`Juegos filtrados: ${filteredGames.length} de ${allGamesData.length}`);
      
      // Actualizar t√≠tulo de la secci√≥n
      const listTitle = document.querySelector('.games-list-title');
      if (hasActiveFilters) {
        let filterDesc = [];
        if (genreFilter) filterDesc.push(genreFilter.charAt(0).toUpperCase() + genreFilter.slice(1));
        if (priceFilter === 'free') filterDesc.push('Gratis');
        else if (priceFilter) filterDesc.push('Precio: ' + priceFilter);
        if (ratingFilter) filterDesc.push(ratingFilter + '+ ‚≠ê');
        listTitle.textContent = 'üîç Resultados: ' + (filterDesc.join(' ¬∑ ') || 'Filtrados');
      } else {
        listTitle.textContent = 'üïπÔ∏è Novedades - Todos los Juegos';
      }
      
      // Recargar lista
      document.getElementById('gamesList').innerHTML = '';
      displayedGamesCount = 0;
      loadMoreGames();
    }

    // ============================================
    // UTILIDADES
    // ============================================
    function getImageUrl(url) {
      if (!url) return null;
      if (url.startsWith('http')) return url;
      return API_URL + url;
    }

    function createGameCard(game, isFree) {
      const article = document.createElement('article');
      article.className = 'card';
      article.style.cursor = 'pointer';

      const thumbnailDiv = document.createElement('div');
      thumbnailDiv.className = 'thumb';
      
      if (game.portada_url) {
        const imgUrl = getImageUrl(game.portada_url);
        
        const img = document.createElement('img');
        img.src = imgUrl;
        img.alt = game.titulo;
        img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:8px';
        img.onerror = function() {
          this.style.display = 'none';
          thumbnailDiv.textContent = game.titulo.substring(0, 2).toUpperCase();
          thumbnailDiv.style.background = 'linear-gradient(135deg, var(--accent-1), var(--accent-2))';
          thumbnailDiv.style.display = 'flex';
          thumbnailDiv.style.alignItems = 'center';
          thumbnailDiv.style.justifyContent = 'center';
          thumbnailDiv.style.fontSize = '32px';
          thumbnailDiv.style.fontWeight = 'bold';
          thumbnailDiv.style.color = '#07102a';
        };
        thumbnailDiv.appendChild(img);
        thumbnailDiv.style.overflow = 'hidden';
      } else {
        thumbnailDiv.textContent = game.titulo.substring(0, 2).toUpperCase();
      }

      const title = document.createElement('h3');
      title.textContent = game.titulo;

      const description = document.createElement('p');
      description.textContent = `${game.genero} ¬∑ ${game.desarrollador_nombre || 'Indie'}`;

      article.appendChild(thumbnailDiv);
      article.appendChild(title);
      article.appendChild(description);

      if (isFree) {
        const freeTag = document.createElement('div');
        freeTag.style.cssText = 'margin-top:8px;padding:8px;background:rgba(76,175,80,0.1);border-radius:6px';
        freeTag.innerHTML = '<small style="color:#4CAF50;font-weight:600">‚ú® GRATIS</small>';
        article.appendChild(freeTag);

        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'btn';
        downloadBtn.style.cssText = 'width:100%;margin-top:12px;background:linear-gradient(90deg,#4CAF50,#45a049);color:#fff;font-weight:600';
        downloadBtn.textContent = 'üéÆ Obtener gratis';
        downloadBtn.onclick = (e) => {
          e.stopPropagation();
          handleFreeGameDownload(game);
        };
        article.appendChild(downloadBtn);
      } else {
        const priceRow = document.createElement('div');
        priceRow.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-top:12px';
        
        const priceSpan = document.createElement('span');
        priceSpan.style.cssText = 'font-size:18px;font-weight:700;color:var(--accent-1)';
        priceSpan.textContent = `$${parseFloat(game.precio).toFixed(2)}`;
        
        const addBtn = document.createElement('button');
        addBtn.className = 'btn';
        addBtn.style.cssText = 'background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#07102a;padding:8px 16px';
        addBtn.textContent = 'üõí Agregar';
        addBtn.onclick = (e) => {
          e.stopPropagation();
          handleAddToCart(game);
        };
        
        priceRow.appendChild(priceSpan);
        priceRow.appendChild(addBtn);
        article.appendChild(priceRow);
      }

      article.onclick = () => {
        openGameDetailModal(game.id);
      };

      return article;
    }

    async function handleFreeGameDownload(game) {
      if (!isAuthenticated()) {
        showToast('Debes iniciar sesi√≥n para descargar juegos gratis', 'error');
        setTimeout(() => {
          window.location.href = 'inicio.html';
        }, 1500);
        return;
      }

      try {
        // Primero agregar a biblioteca
        const response = await apiGetJuegoGratis(game.id);
        
        if (response.success || response.id) {
          showToast('‚úÖ ¬°Juego agregado a tu biblioteca! Iniciando descarga...', 'success');
          
          // Ahora descargar directamente
          setTimeout(() => {
            downloadFreeGame(game);
          }, 1000);
        } else if (response.detail && response.detail.includes('ya')) {
          // Ya lo tiene en biblioteca, solo descargar
          showToast('üì• Iniciando descarga...', 'info');
          downloadFreeGame(game);
        } else {
          showToast('‚ùå ' + (response.message || response.detail || 'Error al obtener el juego'), 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        // Si el error es que ya lo tiene, descargar igual
        if (error.message && error.message.includes('ya')) {
          showToast('üì• Iniciando descarga...', 'info');
          downloadFreeGame(game);
        } else {
          showToast('‚ùå Error al procesar la solicitud', 'error');
        }
      }
    }
    
    function downloadFreeGame(game) {
      // Construir URL de descarga
      let downloadUrl = game.archivo_juego_url;
      
      if (downloadUrl && !downloadUrl.startsWith('http')) {
        const backendUrl = window.location.hostname === 'localhost' 
          ? 'http://localhost:8000'
          : 'https://pyxolotl-production.up.railway.app';
        downloadUrl = `${backendUrl}${downloadUrl}`;
      }
      
      if (downloadUrl) {
        const link = document.createElement('a');
        link.href = downloadUrl;
        link.download = `${game.titulo.replace(/[^a-z0-9]/gi, '_')}.zip`;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        showToast('‚ùå URL de descarga no disponible', 'error');
      }
    }

    async function handleFreeGame(gameId) {
      if (!isAuthenticated()) {
        showToast('Debes iniciar sesi√≥n para obtener juegos gratis', 'error');
        setTimeout(() => {
          window.location.href = 'inicio.html';
        }, 1500);
        return;
      }

      try {
        const response = await apiGetJuegoGratis(gameId);
        if (response.success) {
          showToast('‚úÖ ¬°Juego agregado a tu biblioteca! Ya puedes descargarlo.', 'success');
          setTimeout(() => {
            window.location.href = 'biblioteca.html';
          }, 1500);
        } else {
          showToast('‚ùå ' + (response.message || 'Error al obtener el juego'), 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('‚ùå Error al procesar la solicitud', 'error');
      }
    }
    
    // ============================================
    // SISTEMA DE TOAST NOTIFICATIONS
    // ============================================
    function showToast(message, type = 'info') {
      // Remover toast anterior si existe
      const existing = document.querySelector('.pyxolotl-toast');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.className = 'pyxolotl-toast';
      toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 16px 24px;
        border-radius: 12px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        max-width: 400px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        animation: toastSlideIn 0.3s ease;
        background: ${type === 'error' ? '#ff4757' : type === 'success' ? '#4CAF50' : '#7b61ff'};
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      // Agregar estilos de animaci√≥n si no existen
      if (!document.getElementById('toast-styles')) {
        const style = document.createElement('style');
        style.id = 'toast-styles';
        style.textContent = `
          @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes toastSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      }
      
      setTimeout(() => {
        toast.style.animation = 'toastSlideOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function handleAddToCart(game) {
      if (!isAuthenticated()) {
        showToast('Debes iniciar sesi√≥n para agregar juegos al carrito', 'error');
        setTimeout(() => {
          window.location.href = 'inicio.html';
        }, 1500);
        return;
      }

      if (typeof window.addToCart === 'function') {
        window.addToCart(game.id, game.titulo, game.precio, game.portada_url, game.archivo_juego_url);
      }
    }

    // ============================================
    // VERIFICAR AUTENTICACI√ìN
    // ============================================
    
    function checkAuth() {
      const user = getCurrentUser();
      const loginBtn = document.getElementById('loginBtn');
      const registerBtn = document.getElementById('registerBtn');
      const userProfile = document.getElementById('userProfile');
      const publicarBtn = document.getElementById('publicarBtn');
      const publicarBtnHero = document.getElementById('publicarBtnHero');

      if (user && isAuthenticated()) {
        loginBtn.style.display = 'none';
        if (registerBtn) registerBtn.style.display = 'none';
        userProfile.style.display = 'flex';
        updateUserInterface();

        if (user.tipo_cuenta === 'comprador') {
          if (publicarBtn) publicarBtn.style.display = 'none';
          if (publicarBtnHero) publicarBtnHero.style.display = 'none';
        } else {
          if (publicarBtn) publicarBtn.style.display = 'inline-block';
          if (publicarBtnHero) publicarBtnHero.style.display = 'inline-block';
        }
      } else {
        loginBtn.style.display = 'block';
        if (registerBtn) registerBtn.style.display = 'inline-block';
        userProfile.style.display = 'none';
        if (publicarBtn) publicarBtn.style.display = 'inline-block';
        if (publicarBtnHero) publicarBtnHero.style.display = 'inline-block';
      }
    }

    // Cerrar sesi√≥n - Mostrar modal bonito
    document.getElementById('logoutBtn').addEventListener('click', () => {
      openLogoutModal();
    });
    
    function openLogoutModal() {
      document.getElementById('logoutModal').classList.add('active');
      document.body.classList.add('modal-open');
    }
    
    function closeLogoutModal() {
      document.getElementById('logoutModal').classList.remove('active');
      document.body.classList.remove('modal-open');
    }
    
    function confirmLogout() {
      closeLogoutModal();
      showToast('üëã ¬°Hasta pronto!', 'info');
      setTimeout(() => {
        logout();
      }, 500);
    }

    // ============================================
    // GESTI√ìN DE SESI√ìN Y PERFIL DE USUARIO
    // ============================================
    
    // Verificar si hay una sesi√≥n activa al cargar la p√°gina
    function checkUserSession() {
      const user = getCurrentUser();
      const token = getAuthToken();
      
      // Referencias a elementos
      const loginBtn = document.getElementById('loginBtn');
      const registerBtn = document.getElementById('registerBtn');
      const userProfile = document.getElementById('userProfile');
      const developerPromo = document.getElementById('developerPromo');
      const publicarBtns = document.querySelectorAll('#publicarBtn, #publicarBtnHero');
      const noGamesPublishBtn = document.getElementById('noGamesPublishBtn');
      const footerPublishLink = document.getElementById('footerPublishLink');
      
      if (user && token) {
        // Usuario logueado
        loginBtn.style.display = 'none';
        registerBtn.style.display = 'none';
        userProfile.style.display = 'flex';
        
        // Establecer nombre de usuario
        document.getElementById('userName').textContent = user.nombre || 'Usuario';
        
        // Cargar datos del perfil
        loadProfileData(user);
        
        // Configurar bot√≥n de cerrar sesi√≥n
        document.getElementById('logoutBtn').addEventListener('click', function() {
          logout();
        });
        
        // Verificar tipo de cuenta
        if (user.tipo_cuenta === 'desarrollador' || user.tipo_cuenta === 'administrador') {
          // ES DESARROLLADOR/ADMIN - Mostrar botones de publicar
          if (developerPromo) developerPromo.style.display = 'none';
          publicarBtns.forEach(btn => {
            btn.style.display = 'inline-block';
          });
          if (noGamesPublishBtn) {
            noGamesPublishBtn.style.display = 'inline-block';
          }
          if (footerPublishLink) {
            footerPublishLink.parentElement.style.display = 'block';
          }
        } else {
          // ES COMPRADOR - Ocultar botones, mostrar promo
          if (developerPromo) developerPromo.style.display = 'block';
          publicarBtns.forEach(btn => {
            btn.style.display = 'none';
          });
          if (noGamesPublishBtn) {
            noGamesPublishBtn.style.display = 'none';
          }
          if (footerPublishLink) {
            footerPublishLink.parentElement.style.display = 'none';
          }
        }
      } else {
        // VISITANTE sin sesi√≥n
        loginBtn.style.display = 'block';
        registerBtn.style.display = 'block';
        userProfile.style.display = 'none';
        
        // Mostrar mensaje promocional
        if (developerPromo) developerPromo.style.display = 'block';
        
        // Ocultar TODOS los botones de publicar (incluido footer)
        publicarBtns.forEach(btn => {
          btn.style.display = 'none';
        });
        if (noGamesPublishBtn) {
          noGamesPublishBtn.style.display = 'none';
        }
        if (footerPublishLink) {
          footerPublishLink.parentElement.style.display = 'none';
        }
      }
    }
    
    // Cargar datos del perfil desde localStorage
    function loadProfileData(user) {
      const profileData = JSON.parse(localStorage.getItem('userProfile') || '{}');
      
      // Cargar avatar o iniciales
      const userAvatar = document.getElementById('userAvatar');
      const userInitials = document.getElementById('userInitials');
      const profileAvatarImg = document.getElementById('profileAvatarImg');
      const profileInitials = document.getElementById('profileInitials');
      
      if (profileData.avatar) {
        // Si hay avatar guardado
        userAvatar.innerHTML = `<img src="${profileData.avatar}" alt="Avatar">`;
        profileAvatarImg.src = profileData.avatar;
        profileAvatarImg.style.display = 'block';
        profileInitials.style.display = 'none';
      } else {
        // Mostrar iniciales
        const initials = getInitials(user.nombre);
        userInitials.textContent = initials;
        profileInitials.textContent = initials;
        profileAvatarImg.style.display = 'none';
        profileInitials.style.display = 'block';
      }
      
      // Cargar sobrenombre y descripci√≥n
      if (profileData.nickname) {
        document.getElementById('nickname').value = profileData.nickname;
      }
      if (profileData.description) {
        document.getElementById('description').value = profileData.description;
      }
      
      // ‚úÖ NUEVO: Mostrar sobrenombre en lugar del nombre si existe
      const displayName = profileData.nickname || user.nombre;
      document.getElementById('userName').textContent = displayName;
      
      // Establecer nombre completo en el modal
      document.getElementById('profileName').textContent = user.nombre;
      
      // ‚úÖ NUEVO: Ocultar parcialmente el email (ej: wrgal***@gmail.com)
      const maskedEmail = maskEmail(user.email);
      document.getElementById('profileEmail').textContent = maskedEmail;
    }
    
    // ‚úÖ NUEVA FUNCI√ìN: Ocultar parcialmente el email
    function maskEmail(email) {
      if (!email || !email.includes('@')) return email;
      
      const [localPart, domain] = email.split('@');
      
      // Mostrar primeros 5 caracteres y ocultar el resto con ***
      let maskedLocal;
      if (localPart.length <= 5) {
        maskedLocal = localPart.substring(0, 2) + '***';
      } else {
        maskedLocal = localPart.substring(0, 5) + '***';
      }
      
      return `${maskedLocal}@${domain}`;
    }
    
    // Obtener iniciales del nombre
    function getInitials(name) {
      if (!name) return 'U';
      const parts = name.split(' ');
      if (parts.length >= 2) {
        return (parts[0][0] + parts[1][0]).toUpperCase();
      }
      return name.substring(0, 2).toUpperCase();
    }
    
    // Abrir modal de perfil
    function openProfileModal() {
      const modal = document.getElementById('profileModal');
      modal.classList.add('active');
    }
    
    // Cerrar modal de perfil
    function closeProfileModal() {
      const modal = document.getElementById('profileModal');
      modal.classList.remove('active');
    }
    
    // Manejar cambio de avatar - Preview en tiempo real
    function handleAvatarChange(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const base64Image = e.target.result;
          
          // Actualizar avatar en el modal (preview grande)
          const profileAvatarImg = document.getElementById('profileAvatarImg');
          profileAvatarImg.src = base64Image;
          profileAvatarImg.style.display = 'block';
          document.getElementById('profileInitials').style.display = 'none';
          
          // ‚úÖ NUEVO: Actualizar avatar en el header EN TIEMPO REAL
          const userAvatar = document.getElementById('userAvatar');
          userAvatar.innerHTML = `<img src="${base64Image}" alt="Avatar">`;
          
          // Guardar temporalmente para cuando se guarde el formulario
          profileAvatarImg.dataset.tempAvatar = base64Image;
        };
        reader.readAsDataURL(file);
      }
    }
    
    // Guardar cambios del perfil
    document.getElementById('profileForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const profileData = JSON.parse(localStorage.getItem('userProfile') || '{}');
      const user = getCurrentUser();
      
      // Guardar sobrenombre y descripci√≥n
      profileData.nickname = document.getElementById('nickname').value;
      profileData.description = document.getElementById('description').value;
      
      // Guardar avatar si hay uno nuevo
      const profileAvatarImg = document.getElementById('profileAvatarImg');
      if (profileAvatarImg.dataset.tempAvatar) {
        profileData.avatar = profileAvatarImg.dataset.tempAvatar;
        delete profileAvatarImg.dataset.tempAvatar;
      } else if (profileAvatarImg.src && profileAvatarImg.style.display !== 'none') {
        profileData.avatar = profileAvatarImg.src;
      }
      
      // Guardar en localStorage
      localStorage.setItem('userProfile', JSON.stringify(profileData));
      
      // Actualizar el avatar en el header
      const userAvatar = document.getElementById('userAvatar');
      if (profileData.avatar) {
        userAvatar.innerHTML = `<img src="${profileData.avatar}" alt="Avatar">`;
      }
      
      // ‚úÖ NUEVO: Actualizar nombre en el header (sobrenombre o nombre real)
      const displayName = profileData.nickname || (user ? user.nombre : 'Usuario');
      document.getElementById('userName').textContent = displayName;
      
      // Cerrar modal
      closeProfileModal();
      
      // Mostrar confirmaci√≥n
      showNotification('‚úÖ Perfil actualizado correctamente');
    });
    
    // ‚úÖ NUEVO: Actualizar nombre en tiempo real cuando se escribe el sobrenombre
    document.getElementById('nickname').addEventListener('input', function(e) {
      const user = getCurrentUser();
      const nickname = e.target.value.trim();
      const displayName = nickname || (user ? user.nombre : 'Usuario');
      document.getElementById('userName').textContent = displayName;
    });
    
    // Funci√≥n para mostrar notificaciones
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--card);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    // Cerrar modal al hacer clic fuera
    document.getElementById('profileModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeProfileModal();
      }
    });
    
    // A√±adir estilos de animaci√≥n
    const styleSheet = document.createElement('style');
    styleSheet.textContent = `
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(100px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      
      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100px);
        }
      }
    `;
    document.head.appendChild(styleSheet);
    
    // Ejecutar verificaci√≥n de sesi√≥n al cargar
    checkUserSession();
    
    // ============================================
    // VALIDAR PUBLICAR JUEGO (Requiere login)
    // ============================================
    function validarPublicarJuego(event) {
      event.preventDefault();
      const user = getCurrentUser();
      
      if (!user || !isAuthenticated()) {
        showNotification('‚ö†Ô∏è Debes iniciar sesi√≥n para publicar un juego');
        setTimeout(() => {
          window.location.href = 'inicio.html';
        }, 1500);
        return;
      }
      
      if (user.tipo_cuenta === 'comprador') {
        showNotification('‚ö†Ô∏è Solo las cuentas de desarrollador pueden publicar juegos');
        return;
      }
      
      // Si todo est√° bien, redirigir a la p√°gina de publicar
      window.location.href = 'publicar-juego.html';
    }

    // ============================================
    // INICIALIZACI√ìN CR√çTICA - DETECTAR SESI√ìN
    // ============================================
    
    // Funci√≥n para actualizar el contador del carrito
    function actualizarContadorCarrito() {
      try {
        const cart = localStorage.getItem('cart');
        const cartItems = cart ? JSON.parse(cart) : [];
        const cartCount = document.getElementById('cartCount');
        
        if (cartCount) {
          cartCount.textContent = cartItems.length;
        }
      } catch (error) {
        console.error('Error al actualizar contador del carrito:', error);
      }
    }
    
    // Funci√≥n principal de inicializaci√≥n
    async function initializeApp() {
      console.log('Inicializando aplicaci√≥n...');
      
      // 1. Verificar sesi√≥n activa PRIMERO
      checkUserSession();
      
      // 2. Cargar juegos desde el backend
      await loadGames();
      
      // 3. Actualizar contador del carrito
      actualizarContadorCarrito();
      
      console.log('Aplicaci√≥n inicializada correctamente');
    }
    
    // Ejecutar cuando el DOM est√© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      // DOM ya est√° listo, ejecutar inmediatamente
      initializeApp();
    }
    
    // Tambi√©n verificar sesi√≥n cuando la p√°gina obtiene el foco
    window.addEventListener('focus', function() {
      checkUserSession();
    });
    
    // Verificar sesi√≥n cuando se vuelve de otra pesta√±a
    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        checkUserSession();
      }
    });
    
    // ============================================
    // MEN√ö M√ìVIL
    // ============================================
    const menuBtn = document.getElementById('menuBtn');
    const nav = document.querySelector('.nav');
    const menuOverlay = document.getElementById('menuOverlay');
    
    function toggleMobileMenu() {
      nav.classList.toggle('open');
      menuOverlay.classList.toggle('show');
      
      if (nav.classList.contains('open')) {
        menuBtn.textContent = '‚úï';
        document.body.style.overflow = 'hidden';
      } else {
        menuBtn.textContent = '‚ò∞';
        document.body.style.overflow = '';
      }
    }
    
    function closeMobileMenu() {
      nav.classList.remove('open');
      menuOverlay.classList.remove('show');
      menuBtn.textContent = '‚ò∞';
      document.body.style.overflow = '';
    }
    
    if (menuBtn && nav && menuOverlay) {
      menuBtn.addEventListener('click', toggleMobileMenu);
      menuOverlay.addEventListener('click', closeMobileMenu);
      
      nav.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', closeMobileMenu);
      });
    }
    
    // ============================================
    // BIBLIOTECA MODAL
    // ============================================
    
    async function openBibliotecaModal(event) {
      if (event) event.preventDefault();
      
      // Verificar si el usuario est√° autenticado
      const token = getAuthToken();
      if (!token) {
        showToast('‚ö†Ô∏è Inicia sesi√≥n para ver tu biblioteca', 'warning');
        return;
      }
      
      // Mostrar modal
      const modal = document.getElementById('bibliotecaModal');
      modal.classList.add('active');
      document.body.classList.add('modal-open');
      
      // Reset estado
      document.getElementById('bibliotecaLoading').style.display = 'block';
      document.getElementById('bibliotecaEmpty').style.display = 'none';
      document.getElementById('bibliotecaGrid').style.display = 'none';
      
      // Cargar biblioteca
      try {
        const biblioteca = await apiGetBiblioteca();
        
        document.getElementById('bibliotecaLoading').style.display = 'none';
        
        if (!biblioteca || biblioteca.length === 0) {
          document.getElementById('bibliotecaEmpty').style.display = 'block';
          return;
        }
        
        renderBiblioteca(biblioteca);
        
      } catch (error) {
        console.error('Error cargando biblioteca:', error);
        document.getElementById('bibliotecaLoading').innerHTML = `
          <div style="font-size:48px">üòï</div>
          <p style="color:#ff6b6b;margin-top:12px">Error al cargar la biblioteca</p>
          <button class="btn" onclick="openBibliotecaModal()" style="margin-top:16px">Reintentar</button>
        `;
      }
    }
    
    function closeBibliotecaModal() {
      const modal = document.getElementById('bibliotecaModal');
      modal.classList.remove('active');
      document.body.classList.remove('modal-open');
    }
    
    function renderBiblioteca(biblioteca) {
      const grid = document.getElementById('bibliotecaGrid');
      const backendUrl = window.location.hostname === 'localhost' 
        ? 'http://localhost:8000'
        : 'https://pyxolotl-production.up.railway.app';
      
      grid.innerHTML = biblioteca.map(item => {
        const juego = item.juego;
        if (!juego) return '';
        
        let thumbContent;
        if (juego.portada_url) {
          let imgUrl = juego.portada_url;
          if (!imgUrl.startsWith('http')) {
            imgUrl = `${backendUrl}${imgUrl}`;
          }
          thumbContent = `<img src="${imgUrl}" alt="${juego.titulo}" onerror="this.style.display='none';this.parentElement.innerHTML='${juego.titulo.substring(0,2).toUpperCase()}'">`;
        } else {
          thumbContent = juego.titulo.substring(0,2).toUpperCase();
        }
        
        const tipoAdq = item.tipo_adquisicion === 'compra' ? 'üíé' : '‚ú®';
        
        return `
          <div class="biblioteca-item" onclick="openGameDetailModal(${juego.id}); closeBibliotecaModal();">
            <div class="biblioteca-item-thumb">${thumbContent}</div>
            <div class="biblioteca-item-info">
              <div class="biblioteca-item-title">${juego.titulo}</div>
              <div class="biblioteca-item-meta">${tipoAdq} ${juego.genero || 'Indie'}</div>
            </div>
          </div>
        `;
      }).join('');
      
      grid.style.display = 'grid';
    }
    
    // Cerrar biblioteca con Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (document.getElementById('bibliotecaModal').classList.contains('active')) {
          closeBibliotecaModal();
        }
        if (document.getElementById('screenshotModal').classList.contains('active')) {
          closeScreenshotModal();
        }
      }
    });

  </script>
</body>
</html>